<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>habitican Wardrobes</title>
    <meta name="description" content="Wardrobes for Heros of Habitica" />
    <meta name="author" content="@Piti! Code is based on Alys (Alice Harris) lady_alys@oldgods.net code from Data Display Tool" />
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	
<script type="text/javascript">
$(function() { // wraps around all our code to not pollute global namespace
//////////////////////////////////////////////////////////////////////
////   Global Variables                              /////////////////
//////////////////////////////////////////////////////////////////////
"use strict";
var content = {}; // Habitica's content
var user = {}; // holds user content
var tasksFromDb = {}; // holds tasks
var party = {};
var serverUrl = 'https://habitica.com:443/api/v3';
var userID     = '';
var apiToken   = '';
var url = '';
var legendary = {"head":"head_special_2", "armor":"armor_special_2", "weapon":"weapon_special_2","shield":"shield_special_goldenknight"}; // Nameless Helm, Jean Chalard's Noble Tunic, Stephen Weber's Shaft of the Dragon, Mustaine's Milestonemashing Morningstar
var blessing = {};
var intelligence = {};
var perception = {};
var constitution = {};
var strength = {};
var initialGear = {};
var amountOfSkill = 0; 
var rememberGear = "true"; // use string (required by localStorage)
var threshold = 3;
var alternativeAttribute = 'none';
var forceAetherAmuletAndComicalArrow = 'false';
var frontEnd = "skills"; // for toggling between "wardrobes" and "skills" / later get content from localstorage
var cronHelperWardrobeForTasks = 'disabled';
var cronHelperWardrobeForCron = 'disabled';
var wardrobeEquipped = ['Initial'];
var userName = '';
var equipCount = 0;
var equipCountSkip = 0;
var nameOfWardrobe = 'perception'; 
var skills = {"rogue": {
				"field1": {
					"name": "Tools of the Trade", 
                    "API": "https://habitica.com/api/v4/user/class/cast/toolsOfTrade",
                    "cost": 25, 
					"nameOfWardrobe": "Perception",
					"unlock": 13,  
					"wardrobe": "perception"   // will be replaced by wardrobe-object
					},
				"field2": {
					"name": "Stealth", 
                    "API": "https://habitica.com/api/v4/user/class/cast/stealth",
                    "cost": 45, 
					"nameOfWardrobe": "Perception",
					"unlock": 14,
					"wardrobe": "perception" },
				"field3": {
					"name": "Pickpocket", 
                    "API": "https://habitica.com/api/v4/user/class/cast/pickPocket",
                    "cost": 10, 
					"nameOfWardrobe": "Perception",
					"wardrobe": "perception",
					"unlock": 11, 
					"task": "pending",  // will be replaced by evaluateTasks();
					"taskId": "pending"},
				"field4": {
					"name": "Backstab", 
                    "API": "https://habitica.com/api/v4/user/class/cast/backStab",
                    "cost": 15, 
					"nameOfWardrobe": "Strength",
					"wardrobe": "strength",
					"unlock": 12, 
					"task": "pending",
					"taskId": "pending" }	
				},
			  "wizard": {
				"field1": {
					"name": "Earthquake", 
                    "API": "https://habitica.com/api/v4/user/class/cast/earth",
                    "cost": 35, 
					"nameOfWardrobe": "Intelligence",
					"unlock": 13, 
					"wardrobe": "intelligence" },
				"field2": {
					"name": "Burst of Flames", 
                    "API": "https://habitica.com/api/v4/user/class/cast/fireball",
                    "cost": 10, 
					"nameOfWardrobe": "Intelligence",
					"wardrobe": "intelligence",
					"unlock": 11, 
					"task": "pending",
					"taskId": "pending" 
					},
				"field3": {
					"name": "Ethereal Surge", 
                    "API": "https://habitica.com/api/v4/user/class/cast/mpheal",
                    "cost": 30, 
					"nameOfWardrobe": "Intelligence",
					"unlock": 12, 
					"wardrobe": "intelligence"
					},
				"field4": {
					"name": "Chilling Frost", 
                    "API": "https://habitica.com/api/v4/user/class/cast/frost",
                    "cost": 40, 
					"nameOfWardrobe": "Intelligence",
					"unlock": 14, 
					"wardrobe": "intelligence" }	
				}, 
			  "warrior": {
				"field1": {
					"name": "Valorous Presence", 
                    "API": "https://habitica.com/api/v4/user/class/cast/valorousPresence",
                    "cost": 20, 
					"nameOfWardrobe": "Strength",
					"unlock": 13, 
					"wardrobe": "strength" },
				"field2": {
					"name": "Brutal Smash", 
                    "API": "https://habitica.com/api/v4/user/class/cast/smash",
                    "cost": 10, 
					"nameOfWardrobe": "Strength",
					"wardrobe": "strength",
					"unlock": 11, 
					"task": "pending",
					"taskId": "pending" },
				"field3": {
					"name": "Intimidating Gaze", 
                    "API": "https://habitica.com/api/v4/user/class/cast/intimidate",
                    "cost": 15, 
					"nameOfWardrobe": "Constitution",
					"unlock": 14, 
					"wardrobe": "constitution" },
				"field4": {
					"name": "Defensive Stance", 
                    "API": "https://habitica.com/api/v4/user/class/cast/defensiveStance",
                    "cost": 25, 
					"nameOfWardrobe": "Constitution",
					"unlock": 12, 
					"wardrobe": "constitution" }	
				},
			  "healer": {
				"field1": {
					"name": "Protective Aura", 
                    "API": "https://habitica.com/api/v4/user/class/cast/protectAura",
                    "cost": 15, 
					"nameOfWardrobe": "Blessing",
					"unlock": 13, 
					"wardrobe": "blessing" },
				"field2": {
					"name": "Searing Brightness", 
                    "API": "https://habitica.com/api/v4/user/class/cast/brightness",
                    "cost": 15, 
					"nameOfWardrobe": "Constitution",
					"unlock": 12, 
					"wardrobe": "constitution" },
				"field3": {
					"name": "Blessing", 
                    "API": "https://habitica.com/api/v4/user/class/cast/healAll",
                    "cost": 25, 
					"nameOfWardrobe": "Blessing",
					"unlock": 14, 
					"wardrobe": "blessing" },
				"field4": {
					"name": "Healing Light", 
                    "API": "https://habitica.com/api/v4/user/class/cast/heal",
                    "cost": 15, 
					"nameOfWardrobe": "Blessing",
					"unlock": 11, 
					"wardrobe": "blessing" }	
				}
			};		//end skill...
			
//////////////////////////////////////////////////////////////////////
////   Get UUID from URL      ////////////////////////////////////////
//////////////////////////////////////////////////////////////////////
var url_vars = getUrlVars();
if (url_vars.uuid) {
    $("#userId").val(url_vars.uuid);
}
function getUrlVars() {
    // Function found at http://stackoverflow.com/questions/4656843/jquery-get-querystring-from-url#answer-4656873
    var vars = [], hash;
    var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
    for(var i = 0; i < hashes.length; i++)
    {
        hash = hashes[i].split('=');
        vars.push(hash[0]);
        vars[hash[0]] = hash[1];
    }
    return vars;
}
//////////////////////////////////////////////////////////////////////
////   Login events      /////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////
$('#userApiDetailsForm').submit(function(event){
    /* The user manually submitted the API connection form. */
    userID   = $('#userId').val();
    apiToken = $('#apiToken').val();
    fetchData();
});
//////////////////////////////////////////////////////////////////////
//// LocalStorage with Fallback to cookies ///////////////////////////
//////////////////////////////////////////////////////////////////////
var storeData = function storeData(key, value) {
    var lsSupport = false;
    // Check for native support
		lsSupport = (function() {
			try {
				localStorage.setItem("Test", "Test");
				localStorage.removeItem("Test");
				return true;
			} catch (exception) {
				return false;
			}
		}());
  
    // If value is detected, set new or modify store
    if (typeof value !== "undefined" && value !== null) {
        // Convert object values to JSON
        if ( typeof value === 'object' ) {
            value = JSON.stringify(value);
        }
        if (lsSupport) { 
            localStorage.setItem(key, "" + value);
        } else { // Use Cookie
            createCookie(key, value, 30);
        }
    }
    // No value supplied, return value
    if (typeof value === "undefined") {
        // Get value
        var data = null; 
		if (lsSupport) { // Native support
            data = localStorage.getItem(key);
        } else { // Use cookie 
            data = readCookie(key);
        }
        
        // Try to parse JSON...
        try {
           data = JSON.parse(data);
        }
        catch(e) {
           data = data;
        }
		if (data != null){
			data = "" + data; 
		}
        return data;
    }
    // Null specified, remove store
    if (value === null) {
        if (lsSupport) { // Native support
            localStorage.removeItem(key);
        } else { // Use cookie
            createCookie(key, '', -1);
        }
    }
   
    /**
     * Creates new cookie or removes cookie with negative expiration
     * @param  key       The key or identifier for the store
     * @param  value     Contents of the store
     * @param  exp       Expiration - creation defaults to 30 days
     */
    function createCookie(key, value, exp) {
        var date = new Date();
        date.setTime(date.getTime() + (exp * 24 * 60 * 60 * 1000));
        var expires = "; expires=" + date.toGMTString();
        document.cookie = key + "=" + value + expires + "; path=/";
    }
    /**
     * Returns contents of cookie
     * @param  key       The key or identifier for the store
     */
    function readCookie(key) {
        var nameEQ = key + "=";
        var ca = document.cookie.split(';');
        for (var i = 0, max = ca.length; i < max; i++) {
            var c = ca[i];
            while (c.charAt(0) === ' ') c = c.substring(1, c.length);
            if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
        }
        return null;
    }
};
//////////////////////////////////////////////////////////////////////
////   Data Fetch Function   /////////////////////////////////////////
//////////////////////////////////////////////////////////////////////
function fetchData() {
    $('#loading .bad' ).hide();
	$('#modalContent').html('Please wait, fetching data from Habitica... 1/3');
	$('#modal').show();
    var ajaxRunningCount = 3; // drops to 0 when all calls have succeeded
    // fetch the site-wide content (gear names and stats, etc):
    $.ajax({
        url: serverUrl + '/content',
        type: 'GET',
        dataType: 'json',
        cache: true,
        success: fetchContentSuccess,
        error: fetchFailure
    });
	// fetch the tasks content (dotods dailies etc):
    $.ajax({
        url: serverUrl + '/tasks/user',
        type: 'GET',
        dataType: 'json',
        cache: true,
		 beforeSend: function(xhr){
		 		xhr.setRequestHeader('x-client', '9226cae6-d852-45da-a51b-ec2c9cb759e6-Habitican Wardrobes');
                xhr.setRequestHeader('x-api-user', userID);
                xhr.setRequestHeader('x-api-key',  apiToken);
            },
        success: fetchTasksSuccess,
        error: fetchFailure
    });
    // fetch the user's own content (gear owned, etc):
	$.ajax({
        url: serverUrl + '/user',
        type: 'GET',
        dataType: 'json',
        cache: false,
        beforeSend: function(xhr){
				xhr.setRequestHeader('x-client', '9226cae6-d852-45da-a51b-ec2c9cb759e6-Habitican Wardrobes');
                xhr.setRequestHeader('x-api-user', userID);
                xhr.setRequestHeader('x-api-key',  apiToken);
            },
        success: fetchUserSuccess,
        error: fetchFailure
        });
    function fetchFailure() {
        $('#modal').hide();
        $('#loading .bad' ).show();
    }
    function fetchContentSuccess(data) {
        content = data.data;
        ajaxRunningCount--;
		if (ajaxRunningCount === 1) {$('#modalContent').html('Please wait, fetching data from Habitica... 3/3');}
		if (ajaxRunningCount === 2) {$('#modalContent').html('Please wait, fetching data from Habitica... 2/3');}
        if (ajaxRunningCount === 0) {  // all ajax calls have finished
            $('#modal').hide();
			parseData();
        }
    }
    function fetchUserSuccess(data) {
        user = data.data;
        ajaxRunningCount--;
        if (ajaxRunningCount === 1) {$('#modalContent').html('Please wait, fetching data from Habitica... 3/3');}
		if (ajaxRunningCount === 2) {$('#modalContent').html('Please wait, fetching data from Habitica... 2/3');}
		if (ajaxRunningCount === 0) { // all ajax calls have finished
            $('#modal').hide();
			parseData();
        }
    }
	function fetchTasksSuccess(data) {
        tasksFromDb = data.data;
        ajaxRunningCount--;
        if (ajaxRunningCount === 1) {$('#modalContent').html('Please wait, fetching data from Habitica... 3/3');}
		if (ajaxRunningCount === 2) {$('#modalContent').html('Please wait, fetching data from Habitica... 2/3');}
        if (ajaxRunningCount === 0) { // all ajax calls have finished
            $('#modal').hide();
			parseData();
        }
    }
} // end of fetchData() //////////////////////////////////////////////
//////////////////////////////////////////////////////////////////////
////   Parse Data Function   /////////////////////////////////////////
//////////////////////////////////////////////////////////////////////
function parseData() {
    var htmlStats = ''; // displaying name, class, current equipment, int, per, str, con
	var htmlStart = '';
    var html = '';
	var htmlEnd = '';
	var int = 0;
	var per = 0;
	var str = 0;
	var con = 0;
	var dailyTotal = 0;
	var dailyTotalStealth = 0; 
	var dailyCompleted = 0;
	var wardrobeEquipped = ['Initial'];
	var mostValueableTaskValue = 0;
	var mostValueableTaskName = "";  
	
function storageFirstLoad() {	
	//front End (wardrobes and skills)
	var frontEnd = storeData('FrontEnd'); 
		if (frontEnd == null) {
		 	frontEnd = 'wardrobes'; 
			storeData('FrontEnd', 'wardrobes'); // set FrontEnd to "wardrobes" on first time opening code in browser
			$('.skills-Container').hide(); 
			}
		if (frontEnd == 'wardrobes') {
			$('.skills-Container').hide();
			}
		if (frontEnd == 'skills') {
			$('.wardrobes-Container').hide();
			}
			
		forceAetherAmuletAndComicalArrow = storeData("Amulet and Arrow"); 
			if (forceAetherAmuletAndComicalArrow == "true") {$("#forceAetherAmuletAndComicalArrow").prop('checked', true);}
			if (forceAetherAmuletAndComicalArrow == null) {
				forceAetherAmuletAndComicalArrow = "true"; 
				storeData("Amulet and Arrow", "true"); 
				$('#forceAetherAmuletAndComicalArrow').prop('checked', true);  
			}
		
		rememberGear = storeData("Remember Gear"); 
			if (rememberGear == "true") {$("#rememberGear").prop('checked', true);}
			if (rememberGear == null) {
				rememberGear = "true"; 
				storeData("Remember Gear", "true"); 
				$('#rememberGear').prop('checked', true);  
			}
			
		threshold = parseInt(storeData('Hard Mode')); // typeop(threshold) = number 
		if (threshold <= 9 && threshold >= 1) {
			$('#threshold').prop('value', threshold);
		} else {
			threshold = 3;
			$('#threshold').prop('value', threshold);
			storeData('Hard Mode', JSON.stringify(threshold));
		}
		alternativeAttribute = storeData('Alt. Attribute'); //typeof(alternativeAttribute) = string
		if (alternativeAttribute != null) {
			$('#alternativeAttribute').prop('value', alternativeAttribute);
		} else {
			alternativeAttribute = 'none';
			$('#alternativeAttribute').prop('value', alternativeAttribute);
			storeData('Alt. Attribute', alternativeAttribute);
		} 
		
		cronHelperWardrobeForTasks = storeData('Tasks'); 
		if (cronHelperWardrobeForTasks != null) {
			$('#cronHelperWardrobeForTasks').prop('value', cronHelperWardrobeForTasks);
		} else {
			cronHelperWardrobeForTasks = 'disabled'; 
			$('#cronHelperWardrobeForTasks').prop('value', cronHelperWardrobeForTasks);
			storeData('Tasks', cronHelperWardrobeForTasks);
		}
		
		cronHelperWardrobeForCron = storeData('Cron'); 
		if (cronHelperWardrobeForCron != null) {
			$('#cronHelperWardrobeForCron').prop('value', cronHelperWardrobeForCron);
		} else {
			cronHelperWardrobeForCron = 'disabled'; 
			$('#cronHelperWardrobeForCron').prop('value', cronHelperWardrobeForCron);
			storeData('Cron', cronHelperWardrobeForCron);
		}
		
		
	
	} // end of funciton storageFirstLoad
	storageFirstLoad();
	
	function evaluateTasks() {
		// get bluest Task for (Burst of Flames(Mage))   // challenge {}: Skill can only be cast on non-challenge tasks, but on habits, dailies and todos
		var bluestTaskId = ""; 
		var bluestTaskValue = 0;
		var bluestTaskName = "";  
		for (var i in tasksFromDb){ 
			if (jQuery.isEmptyObject(tasksFromDb[i].challenge)) {
				if (bluestTaskValue < tasksFromDb[i].value) {
					bluestTaskValue = tasksFromDb[i].value; 
					bluestTaskId = tasksFromDb[i].id
					bluestTaskName = tasksFromDb[i].text; 		
				}
				} 
			} // end for var i in tasksFromDb
		skills.wizard.field2.task = bluestTaskName; 
		skills.wizard.field2.taskId = bluestTaskId; 
		skills.rogue.field3.task = bluestTaskName; 
		skills.rogue.field3.taskId = bluestTaskId; 
		skills.rogue.field4.task = bluestTaskName; 
		skills.rogue.field4.taskId = bluestTaskId; 
		skills.warrior.field2.task = bluestTaskName; 
		skills.warrior.field2.taskId = bluestTaskId; 
		
		
		for (var i in tasksFromDb) { 
			if (tasksFromDb[i].type == 'habit') {
				if (mostValueableTaskValue < tasksFromDb[i].value) {
					mostValueableTaskValue = tasksFromDb[i].value; 
					mostValueableTaskName = tasksFromDb[i].text; 
				}
       			} // endIf daily or habit
			if (tasksFromDb[i].type == 'daily') {
				dailyTotalStealth++; 
				if (tasksFromDb[i].isDue == true) {
					dailyTotal ++;
					}
				if (tasksFromDb[i].completed == true) {
					dailyCompleted ++;
					}	
				} // end if daily
		}; // end for
	}; // end of function evaluateTasks;
	
	function getMaxGear() {
		var maxInt = {"head" : 0, "armor": 0, "weapon": 0, "shield" : 0, "headAccessory": 0, "back": 0, "body": 0, "eyewear": 0};
		var maxPer = {"head" : 0, "armor": 0, "weapon": 0, "shield" : 0, "headAccessory": 0, "back": 0, "body": 0, "eyewear": 0};
		var maxStr = {"head" : 0, "armor": 0, "weapon": 0, "shield" : 0, "headAccessory": 0, "back": 0, "body": 0, "eyewear": 0};
		var maxCon = {"head" : 0, "armor": 0, "weapon": 0, "shield" : 0, "headAccessory": 0, "back": 0, "body": 0, "eyewear": 0};
		var maxBles = {"head" : 0, "armor": 0, "weapon": 0, "shield" : 0, "headAccessory": 0, "back": 0, "body": 0, "eyewear": 0};
		var factor = 1;
		var key = '';
				
		//prefill all wardrobes with the current equipment
		[intelligence, perception, strength, constitution, blessing, legendary, initialGear].forEach(function(container){
			['head', 'armor', 'weapon', 'shield', 'headAccessory', 'back', 'body', 'eyewear'].forEach(function(element){
				container[element] = user.items.gear.equipped[element];  
			})
		})
		
		threshold = parseInt(storeData("Hard Mode")); // read threshold (hard mode) 
		// adjust legendary
		if (user.items.gear.owned.head_special_2 == true) {legendary.head = 'head_special_2'} // fill up legendary
		if (user.items.gear.owned.armor_special_2 == true) {legendary.armor = 'armor_special_2'}
		if (user.items.gear.owned.weapon_special_2 == true) {legendary.weapon = 'weapon_special_2'}
		if (user.items.gear.owned.shield_special_2 == true) {legendary.shield = 'shield_special_2'}		
		
		// first run: check if there is better equipment in inventory, than the epquipment currently equipped 
		for (var item in user.items.gear.owned){ 
						
			key = content.gear.flat[item]; 
			(key.klass == user.stats.class ||
			 key.specialClass == user.stats.class) ? factor = 1.5 : factor = 1; 
						
			if (key.twoHanded != true && user.items.gear.owned[item] != false) {
				
				['head', 'armor', 'weapon', 'shield', 'headAccessory', 'back', 'body', 'eyewear'].forEach(function(element){
				// INT
					if ( 	factor * key.int > maxInt[element] &&
							key.int > 0 &&
							key.type == element &&  
						    factor * key.int >= threshold) {
						intelligence[element] = key.key;
						maxInt[element] = (factor * key.int);
					} // end if
				// PER 
					if ( 	factor * key.per > maxPer[element] &&
							key.per > 0 &&
							key.type == element &&  
						    factor * key.per >= threshold) {
						perception[element] = key.key;
						maxPer[element] = (factor * key.per);
					} // end if		
				// CON
					if ( 	factor * key.con > maxCon[element] &&
							key.con > 0 &&
							key.type == element &&  
							factor * key.con >= threshold)
						{
						constitution[element] = key.key;
						maxCon[element] = (factor * key.con);
					} // end if
				// STR
					if ( 	factor * key.str > maxStr[element] &&
							key.str > 0 &&
							key.type == element &&  
							factor * key.str >= threshold)
						{
						strength[element] = key.key;
						maxStr[element] = (factor * key.str);
					} // end if
				// Blessing for Healers INT+CON
					if ( 	factor * (key.con + key.int)  > maxBles[element] &&
							(key.con + key.int) > 0 &&
							key.type == element && 
							factor * (key.con + key.int) >= threshold)
						{
						blessing[element] = key.key;
						maxBles[element] = (factor * (key.con + key.int));
						} // end if
				}) // end forEach
			} // end if twohanded	
		} // end for var Item in user.items.gear.owned = end first run
		
		//second run: checking if there is a two-handed weapon more valueable than single handed weapon + shield
		//content.gear.flat["weapon_wizard_6"].int = 35; // corrupting one entry for testing purpose and set its INT higher as 32 so it will be chosen... delete if works
		var weaponPoints = 0; 
		var shieldPoints = 0; 
		var twoHandedPoints = 0;
			
		//INT       
		if ('weapon' in intelligence) { 
			(content.gear.flat[intelligence.weapon].klass == user.stats.class || 
			content.gear.flat[intelligence.weapon].specialClass == user.stats.class) ? factor = 1.5 : factor = 1;
			weaponPoints = factor * content.gear.flat[intelligence.weapon].int;
			}
		if ('shield' in intelligence) {
			(content.gear.flat[intelligence.shield].klass == user.stats.class ||
			content.gear.flat[intelligence.shield].specialClass == user.stats.class) ? factor = 1.5 : factor = 1;  
			shieldPoints = factor * content.gear.flat[intelligence.shield].int;
			} 
			
		for (var item in user.items.gear.owned){ // check twoHanded
			content.gear.flat[item].klass == user.stats.class ? factor = 1.5 : factor = 1;
			twoHandedPoints = factor * content.gear.flat[item].int;	
				
			if (content.gear.flat[item].twoHanded == true && twoHandedPoints > (weaponPoints + shieldPoints)) {
				intelligence.weapon = item; 
				delete intelligence.shield;  
			} // end if 
		} // end for var item in user.items.gear.ownded (check twoHanded)
			
		//PER         
		if ('weapon' in perception) { 
			(content.gear.flat[perception.weapon].klass == user.stats.class ||
			content.gear.flat[perception.weapon].specialClass == user.stats.class) ? factor = 1.5 : factor = 1; 
			weaponPoints = factor * content.gear.flat[perception.weapon].per;
			}
		if ('shield' in perception) {
			(content.gear.flat[perception.shield].klass == user.stats.class || 
			content.gear.flat[perception.shield].specialClass == user.stats.class) ? factor = 1.5 : factor = 1; 
			shieldPoints = factor * content.gear.flat[perception.shield].per;
			} 
				
		for (var item in user.items.gear.owned){ // check twoHanded		 
			content.gear.flat[item].klass == user.stats.class ? factor = 1.5 : factor = 1;
			twoHandedPoints = factor * content.gear.flat[item].per;	
				
			if (content.gear.flat[item].twoHanded == true && twoHandedPoints > (weaponPoints + shieldPoints)) {
				perception.weapon = item; 
				delete perception.shield;
			} // end if 
		}	// end for var item in user.items.gear.owned
		// end second run: for var item in user.items.gear.owned 
	
		// third run - check for equipment with alternative attribute exceeding current equipment
		
		
		
		if (alternativeAttribute != 'none'){
			var key = content.gear.flat; 	
			for (var item in user.items.gear.owned){
				
			
				//console.log('next item: ' + key[item].key);
				
				
				[intelligence, perception, strength, constitution, blessing, legendary].forEach(function(wardrobe){
					['headAccessory', 'back', 'body', 'eyewear'].forEach(function(element){
						['int', 'str', 'per', 'con'].forEach(function(attribute){ // these are meant as Habitica attributs, not 3rd-party alternativeAttributes
							if (wardrobe[element] != undefined) {
							if (key[wardrobe[element]].type == key[item].type && key[item].twhoHanded != true) {
								if (wardrobe == intelligence && key[wardrobe[element]].int < threshold) { furtherChecking() }
								if (wardrobe == perception && key[wardrobe[element]].per < threshold) { furtherChecking() }
								if (wardrobe == strength && key[wardrobe[element]].str < threshold) { furtherChecking() }
								if (wardrobe == constitution && key[wardrobe[element]].con < threshold) { furtherChecking() }
								if (wardrobe == blessing && key[wardrobe[element]].bles < threshold) { furtherChecking() }
							} // end if							
								function furtherChecking() {
								if (key[item][alternativeAttribute] >= threshold && // strong alternative item
									key[wardrobe[element]][attribute] <= threshold &&  // weak element in wardorbe
									key[item][alternativeAttribute] >= key[wardrobe[element]][alternativeAttribute]) { // better alternative than wardrobes alternative
																		
											wardrobe[element] = item;
							 				console.log('Alternative Equipment: ' + key[item].key);
								}
							} // end funciton furtherChecking
							
							} else {console.log('undefined element: ' + element);} // end if undefined
						}) // end loop attribute
					}) // end loop element
				}) // end loop wardrobe 
			} // end of third for var item in user.items.gear.owned
		} // end if alternativeAttribute != 'none'
		
		
		// force Aether Amulet and Comical Arrow
		forceAetherAmuletAndComicalArrow = storeData("Amulet and Arrow"); 
		if (forceAetherAmuletAndComicalArrow == "true") {
			$("#forceAetherAmuletAndComicalArrow").prop('checked', true);
			if (user.items.gear.owned.headAccessory_armoire_comicalArrow == true) {
				[intelligence, strength, constitution, blessing, legendary].forEach(function(wardrobe){
					wardrobe.headAccessory = 'headAccessory_armoire_comicalArrow'; 
				})	
			}
			if (user.items.gear.owned.body_special_aetherAmulet == true) {
				[intelligence, strength, constitution, blessing, legendary].forEach(function(wardrobe){
					wardrobe.body = 'body_special_aetherAmulet'; 
				})	
			}
		}
		
							
		addWardrobesToSkills();
		getEquippedWardrobes();
	
} // end of getMaxGear
 	
function addWardrobesToSkills() {
	var field = ["field1", "field2", "field3", "field4"];
	field.forEach(function(item, value){
		var s = skills[user.stats.class][item].nameOfWardrobe;
			if (s == 'Intelligence') {skills[user.stats.class][item].wardrobe = intelligence} 
			if (s == 'Perception') {skills[user.stats.class][item].wardrobe = perception} 
			if (s == 'Strength') {skills[user.stats.class][item].wardrobe = strength} 
			if (s == 'Blessing') {skills[user.stats.class][item].wardrobe = blessing} 
			if (s == 'Constitution') {skills[user.stats.class][item].wardrobe = constitution} 
	}); // end field.forEach
}	// end function addWardrobesToSkills
	
function getEquippedWardrobes() {	
		// get array with all wardrobes currently equipped 
		wardrobeEquipped.includes('Initial') ? wardrobeEquipped = ['Initial'] : wardrobeEquipped = [];				
		
        if (compareGear(intelligence) == true && !wardrobeEquipped.includes('intelligence')) {wardrobeEquipped.push('intelligence');};
        if (compareGear(perception) == true && !wardrobeEquipped.includes('perception')) {wardrobeEquipped.push('perception');};
        if (compareGear(strength) == true && !wardrobeEquipped.includes('strength')) {wardrobeEquipped.push('strength');};
        if (compareGear(blessing) == true && !wardrobeEquipped.includes('blessing')) {wardrobeEquipped.push('blessing');};
        if (compareGear(constitution) == true && !wardrobeEquipped.includes('constitution')) {wardrobeEquipped.push('constitution');};
        if (compareGear(legendary) == true && !wardrobeEquipped.includes('legendary')) {wardrobeEquipped.push('legendary');};
        if (wardrobeEquipped.length > 1) {wardrobeEquipped = wardrobeEquipped.filter(function(item){return item !== 'Initial'}); }; // get rid of 'Initial' in case any other wardrobe matches
 		addBorderToSelectedWardrobe();	
		
        function compareGear(specificWardrobe){ //checks if the currently equipped gear is equal to one of the wardrobes
               var equipped = true
               for (var gear in specificWardrobe){
                       if (specificWardrobe[gear] != user.items.gear.equipped[gear]) {
                               equipped = false; 
                       } // end if    
               } // end for gear in specificWardrobe
               return equipped; 
        }; // end of function compareGear
} // end of getEquippedWardrobes 
		
function calculateAttributes(wardrobe) {
	var equipment = {"int" : 0, "per" : 0, "str" : 0, "con" : 0};
	var bonus = {"int" : 0, "per" : 0, "str" : 0, "con" : 0};
	var total = {"int" : 0, "per" : 0, "str" : 0, "con" : 0};
	var totalUnbuffed = {"int" : 0, "per" : 0, "str" : 0, "con" : 0};
	var totalPerfectDay = {"int" : 0, "per" : 0, "str" : 0, "con" : 0};
	var level = 0;
	var perfectDay = 0;
	var manaRefresh = 0;
	var impactSkill = 0;
	var stealth = 0; // rogue
	var backstab = 0; 
	var pickpocket = 0; 
	var blessing = 0;
	var protectiveAura = 0; 
	var valorousPresence = 0;
	var earthquake = 0;  // mage
	var burstOfFlames = 0; 
	var etherealSurge = 0;
	var chillingFrost = 0; 
	var wardrobeKeys = {};
   	for (var typeOfItem in wardrobe) { //wardrobe is an altered copy of user.items.gear.equipped and contains optimized gear for INT, STR, CON, PER, BLES
   	 	var key = wardrobe[typeOfItem]; // format key: weapon_base_0 e.g.
		wardrobeKeys[key] = content.gear.flat[key];
		if (typeOfItem in wardrobe === true && typeof wardrobeKeys[key] != 'undefined') {
			if (wardrobeKeys[key].klass == user.stats.class ||
				wardrobeKeys[key].specialClass == user.stats.class){
				bonus.int += 0.5 * wardrobeKeys[key].int;
				bonus.str += 0.5 * wardrobeKeys[key].str;
				bonus.per += 0.5 * wardrobeKeys[key].per;
				bonus.con += 0.5 * wardrobeKeys[key].con;
			}
			equipment.int += wardrobeKeys[key].int;
			equipment.per += wardrobeKeys[key].per;
			equipment.str += wardrobeKeys[key].str;
			equipment.con += wardrobeKeys[key].con;
		} // end if typeof wardrobeKeys ... undefined
	}; // end for
	level = Math.floor(user.stats.lvl / 2);
	perfectDay = Math.round(user.stats.lvl / 2);
	if (perfectDay >= 50) {perfectDay = 50;}
	if (level > 50) {level = 50;}
	
	["int", "per", "str", "con"].forEach(function(attr) { 
		totalUnbuffed[attr] = level + equipment[attr] + bonus[attr] + user.stats[attr];
		total[attr] = totalUnbuffed[attr] + user.stats.buffs[attr];
		totalPerfectDay[attr] = totalUnbuffed[attr] + perfectDay;		
	});
	
		var manaRefreshPerfectDay 	  = (2 * totalPerfectDay.int + 30) / 10; // manaRefreshPerfectDay is based on 100% completion rate before cron including only Perfect Day buff
		var manaRefreshCompletionRate = ((2 * totalUnbuffed.int + 30) / 10) * dailyCompleted / dailyTotal; // manaRefreshCompletionRate includes no buffs and is multipied with completion rate
		var currentMana = user.stats.mp;
		var manaMax = Math.round(2 * total.int + 30); // maximum mana points until cron = ( 2 * buffedINT + 30)
		var habit = 0.0025 * manaMax;
		var dailyToDo = 0.01 * manaMax; 
		if (manaMax < 100) {habit = 0.25; dailyToDo = 1;}
		var manaMaxAfterCronCompletionRate = Math.round(2 * totalUnbuffed.int + 30); // at cron on a non-Perfect Day, all buffs are reset to zero
		var manaMaxAfterCronPerfectDay 	   = Math.round(2 * totalPerfectDay.int + 30)//;  + Math.round(level / 2); // at cron on a Perfect Day all buffs are reset to zero, except Perfect Day buff
		var manaAfterCronCompletionRate	   = Math.round(currentMana + manaRefreshCompletionRate); // before checking if manaMaxAfterCron is exceeded.
		var manaAfterCronPerfectDay		   = Math.round(currentMana + manaRefreshPerfectDay); // before checking if manaMaxAfterCron is exceeded.
		var manaCapCompletionRate = 0;
		var manaCapPerfectDay = 0;
		if (dailyCompleted == dailyTotal) { // fixes bug displaying mana max after cron without perfect day buff on the left column when all dailies are completed 
			manaMaxAfterCronCompletionRate = manaMaxAfterCronPerfectDay;
			manaRefreshCompletionRate = manaRefreshPerfectDay; 
			manaAfterCronCompletionRate = manaAfterCronPerfectDay; 
		}
		if (manaAfterCronCompletionRate >= manaMaxAfterCronCompletionRate) {
			manaCapCompletionRate = manaAfterCronCompletionRate - manaMaxAfterCronCompletionRate;
		}
		if (manaAfterCronPerfectDay >= manaMaxAfterCronPerfectDay) {
			manaCapPerfectDay = manaAfterCronPerfectDay - manaMaxAfterCronPerfectDay;
		}
		//rogue
		function toolsOfTheTrade(unbuffedPer) {return Math.ceil(100 * unbuffedPer / (unbuffedPer + 50));}
		var stealth = Math.ceil(0.64 * dailyTotalStealth * total.per / (total.per + 55));
		var backstab = (mostValueableTaskValue + 1) +( 0.5 * total.str); 
		var pickpocket =(100*(mostValueableTaskValue + 1 + (0.5 * total.per))) / 100;  
		//healer
		var blessing = Math.round((total.int + total.con + 5) * 0.04);
		var protectiveAura = Math.round((200 * totalUnbuffed.con) / (200 + totalUnbuffed.con));
		var healingLight =  Math.ceil((total.con + total.int + 5) * 0.075); 
		var searingBrightness = Math.round(4 * (total.int / (total.int + 40))); 
		//warrior
		var brutalSmashTask = Math.round((2.5 * total.str / (total.str + 35)));
		var brutalSmashDamage = Math.round(55 * total.str / (total.str + 70));
		var valorousPresence = Math.ceil((20 * totalUnbuffed.str) / (200 + totalUnbuffed.str));
		var defensiveStance = Math.ceil(40 * totalUnbuffed.con / (totalUnbuffed.con + 200));
		var intimidatingGaze = Math.ceil(24 * totalUnbuffed.con / (totalUnbuffed.con + 200)); 
		 //mage
		var earthquake = Math.ceil((30 * totalUnbuffed.int) / (200 + totalUnbuffed.int));
		var burstOfFlames = (mostValueableTaskValue +1) * 0.075 * total.int;
		var etherealSurge = Math.ceil((total.int * 25) / (total.int + 125)); 
		htmlStats +='<section class="container">' +
					'<div class="one"><section class="innerContainer"><div class="innerOne"><a style="color: #f74e52; vertical-align: middle">STR:</a><h3>' + total.str + '</h3></div>' +
					'<div class="innerTwo"><a>Level: ' + level + '<br></a><a>Equipment: ' + equipment.str + '<br></a><a>Bonus: ' + bonus.str + '<br></a><a>Allocation: ' + user.stats.str + '<br></a><a>Buffs: ' + user.stats.buffs.str + '</a></div></section></div>' +
					
					'<div class="two"><section class="innerContainer"><div class="innerOne"><a style="color: #2995cd; vertical-align: middle">INT:</a><h3>' + total.int + '</h3></div>' +
					'<div class="innerTwo"><a>Level: ' + level + '<br></a><a>Equipment: ' + equipment.int + '<br></a><a>Bonus: ' + bonus.int + '<br></a><a>Allocation: ' + user.stats.int + '<br></a><a>Buffs: ' + user.stats.buffs.int + '</a></div></section></div>' +
					'</section>';
		htmlStats +='<section class="container">' +
					'<div class="one"><section class="innerContainer"><div class="innerOne"><a style="color: #ffa623; vertical-align: middle">CON:</a><h3>' + total.con + '</h3></div>' +
					'<div class="innerTwo"><a>Level: ' + level + '<br></a><a>Equipment: ' + equipment.con + '<br></a><a>Bonus: ' + bonus.con + '<br></a><a>Allocation: ' + user.stats.con + '<br></a><a>Buffs: ' + user.stats.buffs.con + '</a></div></section></div>' +
					
					'<div class="two"><section class="innerContainer"><div class="innerOne"><a style="color: #4f2a93; vertical-align: middle">PER:</a><h3>' + total.per + '</h3></div>' +
					'<div class="innerTwo"><a>Level: ' + level + '<br></a><a>Equipment: ' + equipment.per + '<br></a><a>Bonus: ' + bonus.per + '<br></a><a>Allocation: ' + user.stats.per + '<br></a><a>Buffs: ' + user.stats.buffs.per + '</a></div></section></div>' +
					'</section>';
		// Progression of Mana: 
		var manaLostOnCapCompletionRate = (currentMana + manaRefreshCompletionRate - manaMaxAfterCronCompletionRate);
						if (manaLostOnCapCompletionRate < 0) {
							manaLostOnCapCompletionRate = 0;
						} else { // Perfect Day
							manaAfterCronCompletionRate = manaMaxAfterCronCompletionRate;
						}
		var manaLostOnCapPerfectDay = (currentMana + manaRefreshPerfectDay - manaMaxAfterCronPerfectDay);
						if (manaLostOnCapPerfectDay < 0) {
							manaLostOnCapPerfectDay = 0;
							manaAfterCronPerfectDay = currentMana + manaRefreshPerfectDay;
						} else {
							manaAfterCronPerfectDay = manaMaxAfterCronPerfectDay;
						}
		// Progression of Mana around Cron time
		htmlStats +='<section class="containerMana"><div style="font-weight: bold">&nbsp; Progression of Mana</div>'+
					'<div class="left">Dailies completed:<br><br>' + //first column
					'current Mana:<br>' +
					'Mana refresh at cron:<br>'+
					'Mana lost on cron:<br>'+
					'Mana after Cron:<br>'+
					'Mana max after Cron:'+
					'</div>'+
					'<div class="middle">'+ // second column 
					 + dailyCompleted + '/' + dailyTotal +'<br>'+ // not all Dailies completed
					'<br>'+
					Math.round(currentMana) +'<br>'+ //current mana
					Math.round(manaRefreshCompletionRate) +'<br>'+ // mana refresh calculated on ratio of completed dailies
					Math.round(-manaLostOnCapCompletionRate) +'<br>'+
					Math.round(manaAfterCronCompletionRate) +'<br>'+
					manaMaxAfterCronCompletionRate +
					'</div>'+
					'<div class="right">'+ // third column
					 + dailyTotal + '/' + dailyTotal +'<br>'+ // all Dailies completed
					'<br>'+
					 Math.round(currentMana) +'<br>'+ // current mana
					 Math.round(manaRefreshPerfectDay) +'<br>'+
					 Math.round(-manaLostOnCapPerfectDay) +'<br>'+
					 Math.round(manaAfterCronPerfectDay) +'<br>' +
					 manaMaxAfterCronPerfectDay +
					'</div></section>';
		// Skills
		htmlStats +='<section class="container" style="margin: 5px">'+
					'<div class="skills" style="background-color: #ffffff"> Impact of Skills<br>';
					// ROGUE
					if (user.stats.class == 'rogue') {
						var x = totalUnbuffed.per;
						var y = toolsOfTheTrade(x); // y = toolsOfTheTrade variable
						var z = y;  // z = toolsOfTheTrade fix
						var high = 0; 
						var low = 0;
						// Schleife nach unten  
						while (y == z) {
							x--;
							y  = toolsOfTheTrade(x);
							}
							low = x + 1; 
						// Schleife nach oben  
						x = totalUnbuffed.per;
						y = toolsOfTheTrade(x);
						z = y;  
						while (y == z) {
							x++;
							y  = toolsOfTheTrade(x);
							}
							high = x - 1; 
							
						// start display Skills-section
						htmlStats += '<a class="wrap">'; 
						htmlStats += '<font size="-2">Tools of the Trade: +' + z +'PER<br>';	
						//htmlStats += 'PER<sub>unb</sub>=' + totalUnbuffed.per + '&#8712;{' + low + ',..,' + high + '}<br>';
						htmlStats += 'Stealth: ' + stealth + ' dailies<br>';  
						var xp = Math.round(10 * 75*backstab / (backstab + 50)) / 10; 
						var goldBackstab = Math.round(100*18 * backstab / (backstab + 75)) / 100;
						htmlStats += 'Backstab: ' + xp + 'XP+' + goldBackstab + 'GP<br>' ;
						var goldPickpocket = Math.round(100 * 25 * pickpocket / (pickpocket + 75)) / 100;
						htmlStats +='Pickpocket: ' + goldPickpocket + 'GP</font>';
						// Tooltips
						htmlStats += '<p class="descriptionSkills">Tools of the Trade: +' + z + ' PER.<br><font size ="-2">Based on unbuffed Per: (' + totalUnbuffed.per + ')<br>';
						htmlStats += 'Unbuffed Per in range of ' + low + ' ... ' + high + ' will have same effect.</font><br><br>'; 
						htmlStats += 'Stealth: <font size="-2"> you will avoid </font>' + stealth + '<font size ="-2"> dailies<br>based on Per: (' + total.per + ')</font><br><br>';
						htmlStats += 'Backstab: +' + xp + ' XP +' + goldBackstab + ' GP<br><font size ="-2">Base on STR: (' + total.str + ')<br>';
						htmlStats += 'and your task: ' + mostValueableTaskName + ' with a value of ' + (Math.round(mostValueableTaskValue)) + '</font><br><br>';
						htmlStats += 'Pickpocket: ' + goldPickpocket + '<font size = "-2"><br>Based on Per: (' + total.per + ') and your task: ' + mostValueableTaskName + ' with a value of ' + (Math.round(mostValueableTaskValue)) + '</font>';
						htmlStats += '</p></a>';
						} // end if ROGUE & continue Flexbox 2, 4, 6
					//MAGE
					if (user.stats.class == 'wizard') {
						var x = totalUnbuffed.int;
						var y = earthquake; 
						var high = 0; 
						var low = 0;
						// Schleife nach unten  
						while (y == earthquake) {
							x--;
							y  = Math.round((30 * x) / (200 + x));
							}
							low = x + 1; 
						// Schleife nach oben  
						var x = totalUnbuffed.int;
						var y = earthquake; 
						while (y == earthquake) {
							x++;
							y  = Math.round((30 * x) / (200 + x));
							}
							high = x - 1; 
						htmlStats += '<a class="wrap">'; 	
						htmlStats += '<font size="-2">Earthquake: +' + earthquake + 'INT<br>';	
						//htmlStats += 'INT<sub>unb</sub> = ' + totalUnbuffed.int  + '&#8712;{' + low + ',..,' + high + '}<br>';
						htmlStats += 'Eth.Surge : +' + etherealSurge + 'MP<br>';  
						var xp = Math.round(75 * burstOfFlames / (burstOfFlames + 37.5));
						htmlStats += 'BrstfFlms: ' + total.int / 10 + 'dmg, ' + xp + 'XP<br></font>';
						// Tooltips 
						htmlStats += '<p class="descriptionSkills">Earthquake: +' + earthquake + ' INT.<br><font size ="-2">Based on unbuffed Int: (' + totalUnbuffed.int + ')<br>';
						htmlStats += 'Unbuffed Int in range of ' + low + ' ... ' + high + ' will have same effect.</font><br><br>'; 
						htmlStats += 'Ethereal Surge: +' + etherealSurge + 'MP <font size ="-2">for non Mages<br>based on Int: (' + total.int + ')</font><br><br>';
						htmlStats += 'Burst of Flames: +' + (Math.ceil(total.int / 10)) + 'DMG +' + xp + 'XP<br><font size ="-2">Base on Int: (' + total.int + ')<br></font>';
						htmlStats += '</p></a>';
						}
					
					// HEALER	
					if (user.stats.class == 'healer') {
						htmlStats += '<font sitze ="-2">Healing Light: +' + healingLight + 'HP <br>';
						htmlStats += 'Sear.Brightness: ' + searingBrightness + '<br>'; 
						htmlStats += 'Protective Aura: +' + protectiveAura + 'CON<br>';
						htmlStats += 'Blessing: +' + blessing + 'HP</font>';
						}
					//WARRIOR
					if (user.stats.class == 'warrior') {
						htmlStats += '<font size="-2">BrtSmsh: ' + brutalSmashTask + 'TskVal, +' + brutalSmashDamage + 'dmg<br>'; 
						htmlStats += 'DefStance: +' + defensiveStance + 'CON<sub>You</sub><br>'; 
						var x = totalUnbuffed.str;
						var y = valorousPresence; 
						var high = 0; 
						var low = 0;
						// Schleife nach unten  
						while (y == valorousPresence) {
							x--;
							y  = Math.round((20 * x) / (200 + x));
							}
							low = x + 1; 
						// Schleife nach oben  
						var x = totalUnbuffed.str;
						var y = valorousPresence; 
						while (y == valorousPresence) {
							x++;
							y  = Math.round((20 * x) / (200 + x));
							}
							high = x - 1; 
						htmlStats += 'Val.Pres.: +' + valorousPresence + 'STR<sub>Party</sub><br>';	
						htmlStats += 'STR<sub>unb</sub> = ' + totalUnbuffed.str  + '&#8712;{' + low + ',..,' + high + '}<br>';
						htmlStats +='Int.Gaze: +' + intimidatingGaze + 'CON<sub>Party</sub></font>';
						} // end if WARRIOR
		htmlStats +='</div>'+
					'<div class="mana" style="background-color: #ffffff"> Maximum Mana: ' + manaMax + '<br>' +
					'Mana refresh ...<br>' +
					'- per Habit: ' + (Math.round((habit * 100)) / 100) + '<br>' +
					'- per Daily: ' + (Math.round((dailyToDo * 100)) / 100) + '<br>' +
					'- per To-Do: ' + (Math.round((dailyToDo * 100)) / 100) + '<br>' +
					'</div></section>';
					 	
}; // end of function calculateAttributes
//////////////////////////////
//// calculate and display Skills, Wardrobes and stats
//////////////////////////////	
///////////push in skills container 
evaluateTasks(); 
htmlStats =		'<div class="skills-Container">'; //needs class for toggling between Wardrobes and Skills FrontEnds
htmlStats +=		'<div id="skill1"><br>'+ 
				'<button type="button" id="castSkill1" style="color: #2995cd"> Cast ' + skills[user.stats.class].field1.name + '</button>'+
				'<br><br>'+
				'current Mana points: ' + Math.floor(user.stats.mp) + '<br>' + 
				'cost of buff: ' + skills[user.stats.class].field1.cost + '<br>' +
				'effective number of buffs: ' + Math.floor(user.stats.mp / skills[user.stats.class].field1.cost) + '<br>' +
				'<br>' + 
				'<button type="button" id="sub1" class="sub">-</button>'+
    			'<input type="number" id="amount1" value="1" class="number">'+
    			'<button type="button" id="add1" class="add">+</button><br>'+
				'<br>'+
				'</div>'+
				'<div id="skill2"><br>'+
				'<button type="button" id="castSkill2" style="color: #2995cd"> Cast ' + skills[user.stats.class].field2.name + '</button>';
				if (user.stats.class == 'wizard') {htmlStats += '<br>on ' + skills.wizard.field2.task};
				if (user.stats.class == 'warrior') {	htmlStats += '<br>on ' + skills.warrior.field2.task};
htmlStats +=		'<br><br>'+
				'current Mana points: ' + Math.floor(user.stats.mp) + '<br>' + 
				'cost of buff: ' + skills[user.stats.class].field2.cost + '<br>' +
				'effective number of buffs: ' + Math.floor(user.stats.mp / skills[user.stats.class].field2.cost) + '<br>' +
				'<br>' + 
				'<button type="button" id="sub2" class="sub">-</button>'+
    			'<input type="number" id="amount2" value="1" class="number">'+
				'<button type="button" id="add2" class="add">+</button>'+
				'<br>'+ 
				'</div>'+
				
				'<div id="skill3"><br>'+
				'<button type="button" id="castSkill3" style="color: #2995cd"> Cast ' + skills[user.stats.class].field3.name + '</button>';
				if (user.stats.class == 'rogue') {htmlStats += '<br>on ' + skills.rogue.field3.task};
htmlStats += 	'<br><br>'+
				'current Mana points: ' + Math.floor(user.stats.mp) + '<br>' + 
				'cost of buff: ' + skills[user.stats.class].field3.cost + '<br>' +
				'effective number of buffs: ' + Math.floor(user.stats.mp / skills[user.stats.class].field3.cost) + '<br>' +
				'<br>' + 
				'<button type="button" id="sub3" class="sub">-</button>'+
    			'<input type="number" id="amount3" value="1" class="number">'+
    			'<button type="button" id="add3" class="add">+</button>'+
				'<br>'+
				'</div>'+
				
				'<div id="skill4"><br>'+
				'<button type="button" id="castSkill4" style="color: #2995cd"> Cast ' + skills[user.stats.class].field4.name + '</button>';
				if (user.stats.class == 'rogue') {htmlStats += '<br>on ' + skills.rogue.field4.task};
htmlStats += 	'<br><br>'+
				'current Mana points: ' + Math.floor(user.stats.mp) + '<br>' + 
				'cost of buff: ' + skills[user.stats.class].field4.cost + '<br>' +
				'effective number of buffs: ' + Math.floor(user.stats.mp / skills[user.stats.class].field4.cost) + '<br>' +
				'<br>' + 
				'<button type="button" id="sub4" class="sub">-</button>'+
    			'<input type="number" id="amount4" value="1" class="number" />'+
    			'<button type="button" id="add4" class="add">+</button>'+
				'<br>'+
				'</div>';
	
	htmlStats += '<div>Return to Wardrobe Intelligence: '+
				'<input type="checkbox" id="rememberGear" />'+
				'<div class="avatar"></div>' +
				// display Avatar later because getMaxGear() has not jet finished!
				'</div>';
	htmlStats += '</div>'; //end div skills-Container 
	
	
//////////end push in skills container
	
//	drawFlexboxes;
//function drawFlexboxes() {		
	function picsToFlexbox(copyGear) {
		htmlStats +='<br>'; 
		["head", "armor", "weapon", "shield", "headAccessory", "back", "body", "eyewear"].forEach(function(element){
			if (element in copyGear === true && typeof copyGear[element] != 'undefined') {
				htmlStats += '<a class="wrap"><img src="https://habitica-assets.s3.amazonaws.com/mobileApp/images/shop_' + copyGear[element] + '.png">' + 
  					'<p class="description">' + content.gear.flat[copyGear[element]].text +
					'<br>INT: ' + content.gear.flat[copyGear[element]].int + ' PER: ' + content.gear.flat[copyGear[element]].per +
					'<br>STR: ' + content.gear.flat[copyGear[element]].str + ' CON: ' + content.gear.flat[copyGear[element]].con + '</p>' ;
			} // end if copyGear[gear]		
		}) // end for each	
	
		htmlStats +='</a></div>'; // end single box (flexbox 2 - intelligence)
	} // end function picsToFlexboxes
	$('H1').hide();
	$('#headerExtras').html(
		'<div class="navbar">' +
			'<b>Habitican Wardrobes' +
			'</b>' +
			'<a id="toggleFrontEnd"><i class="fa fa-copy" aria-hidden="true"></i>&nbsp; Wardrobes/Skills</a>' +
  			'<div class="dropdown">' +
				'<button class="dropbtn"><i class="fa fa-book fa-fw" aria-hidden="true"></i>&nbsp; Data ' +
      			'<i class="fa fa-caret-down"></i>' +
    			'</button>' +
    			'<div class="dropdown-content">' +
					'<a id="PAR">Party Cron times</a>' +
      				'<a id="USR">User Data</a>' +
      				'<a id="HCT">Habitica Content</a>' +
      				'<a id="SKL">Skills</a>' +
	  				'<a id="DGR">Gear</a>' +
	  				'<a id="TAS">Tasks</a>' +
					'<a id="ICO">Avatar</a>' +					
	  				'<a id="HLP">Help</a>' +
	  				'<a id="VER">Version Info</a>' +
    			'</div>' +
  			'</div> ' +
			'<a id="CRO">Cron-Helper</a>' +
			'<a id="SET"><i class="fa fa-cog fa-fw" aria-hidden="true"></i>&nbsp; Settings</a>' +
  			'<div class="topnav-right">' +  
  				'<a id="RFR"><i class="fa fa-refresh" aria-hidden="true"></i>&nbsp; Refresh</a>' +
				'<b>' + user.profile.name + '<br><span class="small">' + user.stats.class + '</span></b>' +
			'</div>' +
		'</div>'
	);
	
	frontEnd = storeData("FrontEnd");
	console.log(frontEnd);
	
	//evaluateTasks();
	getMaxGear(); 
	
	htmlStats += '<div class="wardrobes-Container">'; 
	var copyGear = JSON.parse(JSON.stringify(user.items.gear.equipped)); // make a deep copy of user.items.gear.equipped so not to corrupt the origninal var
	//legendary.headAccessory = copyGear.headAccessory; // Accessory in legendary is deriven from effective equipment
	//legendary.back = copyGear.back;
	//legendary.body = copyGear.body;
	//legendary.eyewear = copyGear.eyewear;
	//start flexbox 1
	// initialGear: 
	htmlStats += '<div id="Initial" style="background-color: #cccccc"><h3>Equipped Gear:</h3>'; 
	
	calculateAttributes(copyGear); // continue with content of flexbox 1 there
	htmlStats +='<br>'; 
		["head", "armor", "weapon", "shield", "headAccessory", "back", "body", "eyewear"].forEach(function(element){
			if (element in copyGear === true && typeof copyGear[element] != 'undefined') {
				htmlStats += '<a class="wrap"><img src="https://habitica-assets.s3.amazonaws.com/mobileApp/images/shop_' + copyGear[element] + '.png">' + 
  					'<p class="description">' + content.gear.flat[copyGear[element]].text +
					'<br>INT: ' + content.gear.flat[copyGear[element]].int + ' PER: ' + content.gear.flat[copyGear[element]].per +
					'<br>STR: ' + content.gear.flat[copyGear[element]].str + ' CON: ' + content.gear.flat[copyGear[element]].con + '</p>' ;
			} // end if copyGear[gear]		
		}) // end for each		
		/*for (var i in ["head", "armor", "weapon", "shield", "headAccessory", "back", "body", "eyewear"]) { 
       	 	var gear = ["head", "armor", "weapon", "shield", "headAccessory", "back", "body", "eyewear"][i];
			if (gear in copyGear === true) {	
					htmlStats += '<a class="wrap"><img src="https://habitica-assets.s3.amazonaws.com/mobileApp/images/shop_' + copyGear[gear] + '.png">' + 
  					'<p class="description">' + content.gear.flat[copyGear[gear]].text +
					'<br>INT: ' + content.gear.flat[copyGear[gear]].int + ' PER: ' + content.gear.flat[copyGear[gear]].per +
					'<br>STR: ' + content.gear.flat[copyGear[gear]].str + ' CON: ' + content.gear.flat[copyGear[gear]].con + '</p>' ;
					} // end if copyGear[gear]
			} // end for var i in gearLocation*/
	htmlStats +='</a></div>'; // end single box (flexbox 2, 3, ...6)
	// start Flexbox 2
	// INTELLIGENCE
	htmlStats +='<div id="Intelligence" style="background-color: #2995cd"><h3>Wardrobe Intelligence:  <input id="INT" type="submit" value=" Equip "></h3>'; //e0ffff
	// copy intelligence to copyGear so not to pullute user.items.gear.equipped anymore. 
	copyGear = {};
	["head", "armor", "weapon", "shield", "headAccessory", "back", "body", "eyewear"].forEach(function(gear) {
		if (gear in intelligence) {
				copyGear[gear] = intelligence[gear];
				}
		})
	calculateAttributes(copyGear);
	picsToFlexbox(copyGear); 
	
	
	// start flexbox 3
	// PERCEPTION
	htmlStats +='<div id="Perception" style="background-color: #4f2a93"; border: solid><h3>Wardrobe Perception:  <input id="PER" type="submit" value=" Equip "></h3>'; //continue Flexbox 5 ffdfff
	copyGear = {};
	["head", "armor", "weapon", "shield", "headAccessory", "back", "body", "eyewear"].forEach(function(gear) {
		if (gear in perception) {
				copyGear[gear] = perception[gear];
				}
		})
	calculateAttributes(copyGear);
	picsToFlexbox(copyGear); 
	
		
	// start Flexbox 4
	// STRENGTH
	htmlStats +='<div id="Strength" style="background-color: #f74e52"><h3>Wardrobe Strength:  <input id="STR" type="submit" value=" Equip "></h3>'; //continue Flexbox 7 ff9999
	copyGear = {};
	["head", "armor", "weapon", "shield", "headAccessory", "back", "body", "eyewear"].forEach(function(gear) {
		if (gear in strength) {
				copyGear[gear] = strength[gear];
				}
		})
	calculateAttributes(copyGear);
	picsToFlexbox(copyGear); 
	
	
	// start Flexbox 5 
	// CONSTITUTION
	htmlStats +='<div id="Constitution" style="background-color: #ffa623"><h3>Wardrobe Constitution:  <input id="CON" type="submit" value=" Equip "></h3>'; //continue Flexbox 9 f9f9c9
	copyGear = {};
	["head", "armor", "weapon", "shield", "headAccessory", "back", "body", "eyewear"].forEach(function(gear) {
		if (gear in constitution) {
				copyGear[gear] = constitution[gear];
				}
		})
	calculateAttributes(copyGear);
	picsToFlexbox(copyGear); 	
	
	// Start Flexbox 6
	// BLESSING
	htmlStats +='<div id="Blessing" style="background-color: #f9f9c9"><h3>Wardrobe Blessing:  <input id="BLE" type="submit" value=" Equip "></h3>'; //continue Flexbox 9
	copyGear = {};
	["head", "armor", "weapon", "shield", "headAccessory", "back", "body", "eyewear"].forEach(function(gear) {
		if (gear in blessing) {
				copyGear[gear] = blessing[gear];
				}
		})
	calculateAttributes(copyGear);
	picsToFlexbox(copyGear); 
	
	// Start Flexbox 7
	// LEGENDARY
	htmlStats +='<div id="Legendary" style="background-color: #aabb88"><h3>Wardrobe Legendary: <input id="LEG" type="submit" value=" Equip "></h3>'; //continue Flexbox 9
	copyGear = {};
	["head", "armor", "weapon", "shield", "headAccessory", "back", "body", "eyewear"].forEach(function(gear) {
		if (gear in legendary) {
				copyGear[gear] = legendary[gear];
				}
		})
	calculateAttributes(copyGear);
	picsToFlexbox(copyGear); 
	
	// Flexbox for info about which wardrobe is currently equipped and for some buttons
	htmlStats +='<div id="Overview and Buttons">You are wearing:' +
				'<div id="percept">Wardrobe PER</div>' +
				'<div id="blessin">Wardrobe Blessing</div>' +
				'<div id="strengt">Wardrobe STR</div>' +
				'<div id="initial">Initial wardrobe</div>' +
				'<div id="intelli">Wardrobe INT</div>' +
				'<div id="constit">Wardrobe CON</div>' +
				'<div id="legenda">Legendary wardrobe</div>' +
				'<div>You have ' + dailyCompleted + ' of ' + dailyTotal + ' dailies completed.<div></div></div>' +
				'<div>Your most valueable task is: </div><div> ' + mostValueableTaskName + '<div></div><div> with a value of: ' + Math.round(mostValueableTaskValue) + '</div><div></div>' +
				'</div>' + // end single box;
				'</div>'; // end Flexboxes
			
	$('#userStats').html(htmlStats);
	addBorderToSelectedWardrobe();
	
	
	// now add Avatar:
	var avatar; 
	avatar= '' +
				'<div style="margin: 0px auto 0px 24px; width: 90px; height: 90px;">'+
				'<img src="https://s3.amazonaws.com/habitica-assets/mobileApp/images/skin_' + user.preferences.skin + '.png" style="position: absolute;">'+
				'<img src="https://s3.amazonaws.com/habitica-assets/mobileApp/images/hair_bangs_' + user.preferences.hair.bangs + '_' + user.preferences.hair.color + '.png" style="position: absolute;">' +
				'<img src="https://s3.amazonaws.com/habitica-assets/mobileApp/images/hair_mustache_' + user.preferences.hair.mustache + '_' + user.preferences.hair.color +'.png" style="position: absolute;">' +
				'<img src="https://s3.amazonaws.com/habitica-assets/mobileApp/images/hair_beard_' + user.preferences.hair.beard + '_' + user.preferences.hair.color + '.png" style="position: absolute;">' +
				'<img src="https://s3.amazonaws.com/habitica-assets/mobileApp/images/' + copyGear.eyewear + '.png" style="position: absolute;">' +
				'<img src="https://s3.amazonaws.com/habitica-assets/mobileApp/images/' + copyGear.headAccessory + '.png" style="position: absolute;">' +
				'<img src="https://s3.amazonaws.com/habitica-assets/mobileApp/images/' + copyGear.back +'.png" style="position: absolute;">' +
				'<img src="https://s3.amazonaws.com/habitica-assets/mobileApp/images/' + copyGear.body +'.png" style="position: absolute;">' +
				'<img src="https://s3.amazonaws.com/habitica-assets/mobileApp/images/' + copyGear.weapon +'.png" style="position: absolute;">' +
				'<img src="https://s3.amazonaws.com/habitica-assets/mobileApp/images/' + copyGear.armor +'.png" style="position: absolute;">' +
				'<img src="https://s3.amazonaws.com/habitica-assets/mobileApp/images/' + copyGear.head +'.png" style="position: absolute;">' +
				'<img src="https://s3.amazonaws.com/habitica-assets/mobileApp/images/' + copyGear.shield +'.png" style="position: absolute;">' +
				'</div>';
	$('.avatar').html(avatar);			
	
	
//	} // end function drawFlexboxes; 
function addBorderToSelectedWardrobe() {
	
	//this is triggerd 2x. 1- immediately, 2- after all Ajax-calls are done. 
	// display of data in last Flexbox
	$("#percept").hide();
	$("#constit").hide();
	$("#strengt").hide();
	$("#blessin").hide();
	$("#intelli").hide();
	$("#legenda").hide();
	$("#initial").hide();
	
	//border to displayed wardrobes
	$("#Intelligence").css({"border": "none", "border-color": "yellow"});
	$("#Perception").css({"border": "none", "border-color": "yellow"});
	$("#Constitution").css({"border": "none", "border-color": "yellow"});
	$("#Strength").css({"border": "none", "border-color": "yellow"});
	$("#Blessing").css({"border": "none", "border-color": "yellow"});
	$("#Legendary").css({"border": "none", "border-color": "yellow"});
	if (wardrobeEquipped == 'Initial') { // show if initial wardrobe is not one of Habitican Wardrobes, else hide Initial
		$('#Initial').css({"border": "solid", "border-color": "#4f2a93"});
		} else
		{$('#Initial').hide();}
	if (wardrobeEquipped.includes('intelligence')) {$('#intelli').show(); $("#Intelligence").css({"border": "solid", "border-color": "#4f2a93"});}
	if (wardrobeEquipped.includes('perception')) {$('#percept').show(); $("#Perception").css({"border": "solid", "border-color": "#af8af3"});}
	if (wardrobeEquipped.includes('constitution')) {$('#constit').show();$("#Constitution").css({"border": "solid", "border-color": "#4f2a93"});}
	if (wardrobeEquipped.includes('strength')) {$('#strengt').show();$("#Strength").css({"border": "solid", "border-color": "#4f2a93"});}
	if (wardrobeEquipped.includes('blessing')) {$('#blessin').show();$("#Blessing").css({"border": "solid", "border-color": "#4f2a93"});}
	if (wardrobeEquipped.includes('legendary')) {$('#legenda').show();$("#Legendary").css({"border": "solid", "border-color": "#4f2a93"});}
}; // end of function addBorderToSelectedWardrobe
function prepareSkillAmounts () {
	var skillAmount = [];
	for (var i = 1; i <= 4; i++) {
		var fetchField = "skill" + JSON.stringify(i); 
		var fetchAmount = "amount" + JSON.stringify(i);
		var inputFieldLS = storeData(fetchField);
		
		if (storeData(fetchField) == null || (storeData(fetchField) == "undefined")) {
				skillAmount[i-1] = "1"; 
				}
		if ((storeData(fetchField) != null) && (storeData(fetchField) != "undefined")) { 
				skillAmount[i-1] = storeData(fetchField);  
			}
			storeData(fetchField, skillAmount[i-1]); 
			document.getElementById(fetchAmount).value = skillAmount[i-1];
	}	// end for
} // end function prepareSkillAmounts
// limit the amount of skills to the current Mana-level
function getAmountOfSkill(field) {
		if (field == 'field1') {
			amountOfSkill = parseInt(document.querySelector("#amount1").value);
			if (amountOfSkill > 0) {storeData("skill1", parseInt(document.querySelector("#amount1").value));} // use parseInt to avoid paratheses in localStorage!
			if (Math.floor(user.stats.mp / skills[user.stats.class].field1.cost) <= amountOfSkill) {
					amountOfSkill = Math.floor((user.stats.mp) / (skills[user.stats.class].field1.cost));
					if (amountOfSkill == "NaN") {
						amountOfSkill = 0;  
						}
			//document.querySelector("#amount1").value = amountOfSkill;
			}
		}
		
		
		if (field == 'field2') {
			amountOfSkill = parseInt(document.querySelector('#amount2').value);
			if (amountOfSkill > 0) {storeData('skill2', parseInt(document.querySelector("#amount2").value));} // use parseInt to avoid paratheses in localStorage!
			if (Math.floor((user.stats.mp / skills[user.stats.class].field2.cost))	 < amountOfSkill) {
					amountOfSkill = Math.floor(user.stats.mp / skills[user.stats.class].field2.cost);
					if (amountOfSkill == "NaN") {
						amountOfSkill = 0;  
					}
			console.log(amountOfSkill);
			// document.querySelector("#amount1").value = amountOfSkill;
			}
		}
		
		if (field == 'field3') {
			amountOfSkill = parseInt(document.querySelector("#amount3").value);
			if (amountOfSkill > 0) {storeData("skill3", parseInt(document.querySelector("#amount3").value));} // use parseInt to avoid paratheses in localStorage!
			if (Math.floor((user.stats.mp / skills[user.stats.class].field3.cost))	 < amountOfSkill) {
					amountOfSkill = Math.floor(user.stats.mp / skills[user.stats.class].field3.cost);
					if (amountOfSkill == "NaN") {
					amountOfSkill = 0;  
					}
			console.log(amountOfSkill);
			// document.querySelector("#amount1").value = amountOfSkill;
			}
		}
		
		
		
		if (field == 'field4') {
			amountOfSkill = parseInt(document.querySelector("#amount4").value);
			if (amountOfSkill > 0) {storeData("skill4", parseInt(document.querySelector("#amount4").value));} // use parseInt to avoid paratheses in localStorage!
			if (Math.floor((user.stats.mp / skills[user.stats.class].field4.cost))	 < amountOfSkill) {
					amountOfSkill = Math.floor(user.stats.mp / skills[user.stats.class].field4.cost);
					if (amountOfSkill == "NaN") {
					amountOfSkill = 0;  
					}
			console.log(amountOfSkill);
			// document.querySelector("#amount1").value = amountOfSkill;
			}
		}
		
		return amountOfSkill;
	} // end of getAmountOfSkill
//////////////////////////////////////////////////////////////////////
////   equip function      (within paseData)   ///////////////////////
////   and castSkill function				   ///////////////////////			
//////////////////////////////////////////////////////////////////////
		
// https://petetasker.com/using-async-await-jquerys-ajax/
async function loadAvatar(url) {
		var url = 'https://habitica.com/export/avatar-' + userID + '.html'
		console.log(url);
		let result;  
		try {
			result = await $.ajax({	
					url: 'https://habitica.com/export/avatar-' + userID + '.html',
					type: 'GET',
					//dataType: 'json',
					cache: false,
					beforeSend: function(xhr){
						xhr.setRequestHeader('x-client', '9226cae6-d852-45da-a51b-ec2c9cb759e6-Habitican Wardrobes');
						//xhr.setRequestHeader('x-api-user', userID);
						//xhr.setRequestHeader('x-api-key',  apiToken);
					},
					success: function(result){return result;}
			});
		} catch (error) {
			console.log(error.responseText);
		}						
}; // end ajax
async function doAjax(url){
		let result;  
		try {
			result = await $.ajax({	
					url: url,
					type: 'POST',
					dataType: 'json',
					cache: false,
					beforeSend: function(xhr){
						xhr.setRequestHeader('x-client', '9226cae6-d852-45da-a51b-ec2c9cb759e6-Habitican Wardrobes');
						xhr.setRequestHeader('x-api-user', userID);
						xhr.setRequestHeader('x-api-key',  apiToken);
					},
					success: function(result){}
			});
		return result;
		} catch (error) {
			console.log(error.responseText);
		}						
}; // end ajax
function wait(waitTime) {
  return new Promise(resolve => setTimeout(() => {
    resolve()
  }, waitTime));
}
async function callSkill(amount, url, name, cost, nameOfWardrobe, field) {  
  if (user.stats.class == 'wizard' && field == 'field2') {url += '?targetId=' + skills.wizard[field].taskId;}
  if (user.stats.class == 'warrior'&& field == 'field2') {url += '?targetId=' + skills.warrior[field].taskId;}
  if (user.stats.class == 'rogue' && (field == 'field3' || field == 'field4')) {url += '?targetId=' + skills.rogue[field].taskId;}  
  for (var i = 1; i <= amount; i++) {
		$('#modalContent').html('casting: ' + name + '<br>' + i + '/' + amount);		
		if (url.includes('?')) {
			$('#modalContent').html('casting: ' + name + '<br> on ' + skills[user.stats.class][field].task + '<br>' + i + '/' + amount);		
			}		
		await doAjax(url);
		user.stats.mp = (user.stats.mp - cost);
  		await wait(1000+(1000 * amount / (0.01 * amount + 20)));
  		}
  parseData();
} // end callSkills...
async function callWardrobe(wardrobe, nameOfWardrobe) {  // wardrobe is intelligence, perception or legendary, each with head, armor, shield and weapon
		
		var itemToEquip = '';
		var typeOfItem = '';
		equipCount = 0;
		equipCountSkip = 0; 
		
		$('#modalContent').html('Equipping...');
		$('#modal').show();
		for (var i in ["head", "armor", "weapon", "shield", "headAccessory", "back", "body", "eyewear"]) { //gearLocation = [head, armor, ... eyewear], i = 1..8
			itemToEquip = wardrobe[["head", "armor", "weapon", "shield", "headAccessory", "back", "body", "eyewear"][i]];  // fromat gear: head_base_0 e.g.
			// First determine the type [Helm, Armor ...] of the Item that is goint to be equipped (The type is taken from Habitica's content)
			typeOfItem = content.gear.flat[itemToEquip].type; //eg displays: head (good)
			// verify if item is already equipped
			htmlEnd += content.gear.flat[itemToEquip].text + '<br>';
					
			if (user.items.gear.equipped[typeOfItem] == itemToEquip) {
					equipCountSkip++;
					if (equipCountSkip===Object.keys(wardrobe).length){ // if equipCountSkip = amount of inventory in wardrobe
						$('#modalContent').html('already equipped');
						await wait(1000);
					} // end if equipCountSkip
			} else {	
				url = 'https://habitica.com/api/v3/user/equip/equipped/'+ itemToEquip;
				$('#modalContent').html('Equipping wardrobe ' + nameOfWardrobe + '<br>' + (equipCountSkip + equipCount) + '/8');
				await doAjax(url);	 
				user.items.gear.equipped[typeOfItem] = itemToEquip;
				equipCount++; 
				await wait(50); 		
			} // end else
		}; // end each
		await wait(500);
		$('#modal').hide();
		getEquippedWardrobes();
} // end function callWardrobe
  
  
async function waitForAlert() {
	alert("waiting... please check if everything is as expected!");
}  
 
async function callTriple (amount, url, name, cost, wardrobe, nameOfWardrobe, field){ // amountOfSkill, API, "eg. Tools of the Trade, 25, perception, Object
	if (wardrobeEquipped.includes(nameOfWardrobe)) {
				console.log(nameOfWardrobe + 'already equipped');
				} else {
					console.log("calling wardrobe " + nameOfWardrobe);
					await callWardrobe(wardrobe, nameOfWardrobe); 	// wardrobe ist Object here
					
				}
			$('#modalContent').html('Casting...');
			$('#modal').show();	
			await callSkill(amountOfSkill,
				    skills[user.stats.class][field].API, 
				    skills[user.stats.class][field].name,
				    skills[user.stats.class][field].cost,
					skills[user.stats.class][field].nameOfWardrobe, 
					field);
			getEquippedWardrobes();
			console.log(wardrobeEquipped, rememberGear);
			if (wardrobeEquipped.includes('intelligence')) {
					console.log(nameOfWardrobe + 'already equipped');
			} else {
					if (rememberGear=="true") { // remberGear displays as "Return to wardrobe Intelligence" on the front End. Think in FrontEnd locig here!
							await callWardrobe(intelligence, 'Intelligence');
					} else { 
							console.log("OK. leaving " + name + " equipped.");
							$('#modal').hide();}
			}	
			getEquippedWardrobes();
} // end callTriple
					
async function prepareTriple(amount, url, name, cost, wardrobe, nameOfWardrobe, field){
	if (user.stats.mp < cost) {		// not enoght mana  ==> break up immediately
			$('#modalContent').html('Not enough Mana.');
			$('#modal').show()
			await wait(1000);
			$('#modal').hide();	
	} else {
			if (user.stats.lvl < skills[user.stats.class][field]){ // level not high enough
					$('#modalContent').html('You need to reach level ' + skills[user.stats.class][field].unlock + ' to cast ' + name);
					$('#modal').show();
					await wait(1000);
					$('#modal').hide();
		 	} else {
					callTriple(amount, url, name, cost, wardrobe, nameOfWardrobe, field);
				   } 
				
	} 
} // end function prepareTriple
async function loadParty(){
		let result;  
		try {
			result = await $.ajax({	
					url: 'https://habitica.com/api/v3/groups/party',
					type: 'GET',
					dataType: 'json',
					cache: false,
					beforeSend: function(xhr){
						xhr.setRequestHeader('x-client', '9226cae6-d852-45da-a51b-ec2c9cb759e6-Habitican Wardrobes');
						xhr.setRequestHeader('x-api-user', userID);
						xhr.setRequestHeader('x-api-key',  apiToken);
					},
					success: function(result){console.log("Party loaded!"); party = result.data}
			});
		return party;
		} catch (error) {
			console.log(error.responseText);
		}		
} // end function loadParty
async function loadMember(memberId){
		var member;  
		try {
			var result = await $.ajax({	
					url: 'https://habitica.com/api/v3/members/' + memberId,
					type: 'GET',
					dataType: 'json',
					cache: false,
					beforeSend: function(xhr){
						xhr.setRequestHeader('x-client', '9226cae6-d852-45da-a51b-ec2c9cb759e6-Habitican Wardrobes');
						//xhr.setRequestHeader('x-api-user', userID);
						//xhr.setRequestHeader('x-api-key',  apiToken);
					},
					success: function(result){member = result.data;}
			});
		return member; 
		} catch (error) {
			console.log(error.responseText);
		}		
} // end function loadPary
async function partyCronTimes(){
		$('#modalContent').html('Loading group data...');
		$('#modal').show();
		party = await loadParty(); 
		var modalHtml = '';
		var members; 
		var memberId = [];
		var memberData = {};
		var memberName = [];
		var memberLastCron = [];
		var memberLastCronMilliseconds = [];
		var i=0;
		for (members in party.quest.members) { // member resolves in f74e2316-cad6-4da4-83aa-1ac8c586a8fc eg
			memberId[i] = members; 
			$('#modalContent').html('Loading member data...' + i);
			memberData = await loadMember(memberId[i]);
			memberName[i] = memberData.auth.local.username;
			var date = new Date(memberData.auth.timestamps.loggedin); // transfer UTC to local time zone
			memberLastCron[i] = date.getFullYear() + '/' +
								(date.getMonth() + 1) + '/' + 
								(date.getDate()<10 ? '0': '') + date.getDate() + ' ' + 
								(date.getHours()<10 ? '0': '') + date.getHours() + ':' + 
								(date.getMinutes()<10 ? '0': '') + date.getMinutes(); 
			memberLastCronMilliseconds[i] = date.getTime();  
			i++; 
			}
		
		for (var i=0; i < memberLastCronMilliseconds.length; i++) {
			for (var j=0; j < i; j++) {
				if (memberLastCronMilliseconds[i] < memberLastCronMilliseconds[j]) {
					
					var x = memberLastCronMilliseconds[i];
					memberLastCronMilliseconds[i] = memberLastCronMilliseconds[j];
					memberLastCronMilliseconds[j] = x; 
					
					var x = memberName[i];
					memberName[i] = memberName[j];
					memberName[j] = x; 
					
					var x = memberLastCron[i]; 
					memberLastCron[i] = memberLastCron[j];
					memberLastCron[j] = x;
				}
			}
		}
		
		modalHtml = 	'<div>These are the recent Cron-times of all members in your party. <br>: <br><pre>' + 
						'<table>' +
							'<tr>' +
								'<th>Party member</th>' +
								'<th>Last Cron</th>' +
							'</tr>';
		
		for (var i=0; i < memberName.length; i++) {
			modalHtml += '<tr>' +
			 			 	'<td>' + memberName[i] + '</td> ' +
							'<td>' + memberLastCron[i] + '</td>' +  
						 '</tr>';
			}
		modalHtml += '</table>'; 
		$('#modal').hide();
		modalHtml += '</pre></div>';
		$('.dataSectionxy').html(modalHtml);
		$('#modalData').show(); 				
}; 
// cronHelper Ajax section
async function scoreTaskDoAjax(id, direction, row){
		
		$('#modalContent').html('Scoring task...'); 
		$('#modal').show();
		
		var mana = 0;
		var gold = 0;
		var health = 0; 
		var level = 0; 
		var experience = 0;
		
		// Prepare Ajax for scoring task. If ChecklitItem then score ChecklistItem
		
		for (var key in tasksFromDb) {
		
			// dealing with checklistItems
			if (tasksFromDb[key].hasOwnProperty("checklist") && tasksFromDb[key].checklist != '') { 
				for (var checklistKey in tasksFromDb[key].checklist) {
						if (tasksFromDb[key].checklist[checklistKey].id == id) { 
							url = 'https://habitica.com/api/v3/tasks/' + tasksFromDb[key].id + '/checklist/' + id + '/score';
						} 
				}
			}
			// dealing with main-tasks including main-tasks with checklistitems
			if (tasksFromDb[key].id == id) {
				var url = 'https://habitica.com/api/v3/tasks/' + id + '/score/' + direction
				if (tasksFromDb[key].hasOwnProperty('checklist') && tasksFromDb[key].checklist != '') {
					if (confirm('There are unchecked checklist items.\n\nAre you sure?')) {}
					else {$('#modal').hide(); return;}
				}
			}
		} // end for var key in tasksFromDB	
		
		// now try ajax
		try {
			var result = await $.ajax({		
					url: url, 
					type: 'POST',
					dataType: 'json',
					cache: false,
					beforeSend: function(xhr){
						xhr.setRequestHeader('x-client', '9226cae6-d852-45da-a51b-ec2c9cb759e6-Habitican Wardrobes');
						xhr.setRequestHeader('x-api-user', userID);
						xhr.setRequestHeader('x-api-key',  apiToken);
					},
					success: function(result){
								mana = result.data.mp - user.stats.mp;
								gold = result.data.gp - user.stats.gp;
								health = result.data.hp - user.stats.hp;
								level = result.data.lvl - user.stats.lvl;
								experience = result.data.exp - user.stats.exp; 
								//write back to var user
								user.stats.mp = result.data.mp;
								user.stats.gp = result.data.gp;
								user.stats.hp = result.data.hp;
								user.stats.lvl = result.data.lvl;
								user.stats.exp = result.data.exp;
								
								var type = '';
								
								if (direction == 'up') {
									var modalHtml = 'You gained:<br>';
									}
								if (direction == 'down') {
									var modalHtml = 'You lost:<br>';
								}
									
									modalHtml += '<div style="width: 60%; color="#444444">' +  
									'<div style="font-size: x-small">\n' +
									'\u2022Mana: ' + Math.round(10 * mana) / 10 + ' points<br>' +
									'\u2022Gold: ' + Math.round(10 * gold) / 10 + ' points<br>' +
									'\u2022Exp.: ' + Math.round(10 * experience) / 10 + ' points<br>';
									if (level > 0) {modalHtml += '\u2022' + level + ' level<br>';}
									if (health > 0) {modalHtml += '\u2022Health: ' + Math.round(10 * health) / 10 + ' points<br>';}
									//if (result.data.hasOwnProperty('drop')) {modalHtml += '\u2022' + result.data.drop.dialog.text + 'found';}
									modalHtml += '</div>'; 
									
									// loop through tasksFromDb (again) to find id and set completed to true and check for deletion of row
									for (var key in tasksFromDb) {
										// 1st treat checklistItems
										if (tasksFromDb[key].hasOwnProperty("checklist") && tasksFromDb[key].checklist != '') {
											if (tasksFromDb[key].id == id) { // resolves in 'mainTask checked, while there are checklistItems'
												tasksFromDb[key].completed = true; 		
											} else { // resolves as checklistItemChecked
												for (var checklistKey in tasksFromDb[key].checklist) {
													if (tasksFromDb[key].checklist[checklistKey].id == id) {
														tasksFromDb[key].checklist[checklistKey].completed = true; 
														}
													}
												}
											
										} else { // end if checklistItem // if not a checklistItem
										// 2nd treat non-checklistItems
										
											if (tasksFromDb[key].id == id) {
												if (direction == 'up' && tasksFromDb[key].type != 'habit') {
													tasksFromDb[key].completed = true;
													} 
												if (direction == 'up' && tasksFromDb[key].type == 'habit') {
													tasksFromDb[key].counterUp++;
												}
												if (direction == 'down' && tasksFromDb[key].type == 'habit') {
													tasksFromDb[key].counterDown++;
												}
												}
											} // end else not a checklistItem
									} // end for var key in tasksFromDb
									modalHtml += '</div>'; 
									$('#modalContent').html(modalHtml);										
									setTimeout(function(){$('#modal').hide();}, 4000);
									console.log('calling cronhelper() again');
									cronHelper(); 
								} // end success function
			});
		} catch (error) {
			$('#modalContent').html('Error: '+ error.responseText);
			$('#modal').show();
			console.log(error);
			setTimeout(function(){$('#modal').hide();}, 2000);
		}
				
} // end function scoreTasksDoAjax
	
	
function cronHelperMakeButton(taskId, direction, type, up, down) {
	// mainTaskId is taskId in case of ChecklistItem: taskId will then be checklistId
	var result = '';
			
	if (type == 'daily' && direction == 'up') {
		result = '<button style="border-radius: 10px; border-style: none" class="up" id="' + taskId + '">+</button>';
		}
	if (type == 'todo' && direction == 'up') {
		result = '<button style="border-radius: 10px; border-style: none" class="up" id="' + taskId + '">+</button>';
		}
	if (type == 'habit' && direction == 'up' && up != false) {
		result = '<button style="border-radius: 10px; border-style: none" class="up" id="' + taskId + '">+</button>';
		}
	if (type == 'habit' && direction == 'down' && down != false) {
		result = '<button style="border-radius: 10px; border-style: none" class="down" id="' + taskId + '">-</button>';
		} 
	return result; 	
} // end function cronHelperMakeButton
function cronHelper() {
	var textForTasks = '';
	var textForCron = '';
	var textGeneral = '';
	
	//tasks section - automatic selection of wardrobe takes place here already, rather than later on checking off tasks. 
	if (cronHelperWardrobeForTasks == 'disabled') {
		textForTasks = 'Scoring Tasks: Automatic selection of gear is disabled.'
		textGeneral = 'Under Settings/Cron Helper: you can select optimized gear allocation.<br>Please consider that after automatically changing gear, it is not possible to determine your previously selected battle gear.<br>'	
	} else {
		textForTasks = 'Scoring Tasks: Wardrobe ' + cronHelperWardrobeForTasks + ' is equipped.';
		textGeneral = '';
		// if allowed and desired wardrobe not equipped
		if (!wardrobeEquipped.includes(cronHelperWardrobeForTasks)) {
			if (cronHelperWardrobeForTasks == 'intelligence') {callWardrobe(intelligence, 'Intelligence')}
			if (cronHelperWardrobeForTasks == 'perception') {callWardrobe(perception, 'Perception')}
			if (cronHelperWardrobeForTasks == 'strength') {callWardrobe(strength, 'Strength')}
			if (cronHelperWardrobeForTasks == 'legendary') {callWardrobe(legendary, 'Legendary')}
		} 
	} // end Tasks section
	
	// cron section
	if (cronHelperWardrobeForCron == 'disabled') {
		textForCron = 'Running Cron: Automatic selection of gear is disabled.'
		textGeneral = 'Under Settings/Cron Helper: you can select optimized gear allocation.<br>Please consider that after automatically changing gear, it is not possible to determine your previously selected battle gear.<br>'	
	} else {
		textForCron = 'Running Cron: Wardrobe Intelligence will be selected.'
		if (cronHelperWardrobeForTasks != 'disabled') {
			textGeneral = ''; 
		}
	}
		
	$('#cronHelperInfo').css('font-size', 'x-small');
	$('#cronHelperInfo').html(textForTasks + '<br>' + textForCron + '<br>' + textGeneral);
	
	
	
	
	var x = document.getElementById('cronHelperTable').rows.length;
	for (var i=1; i < x; i++) { // 1st 2 lines are header and space
		document.getElementById('cronHelperTable').deleteRow(-1);
	}
	output('habit');
	output('daily');
	output('todo');
	function output(type) {
		for (var key in tasksFromDb) { // key as number for element
			if (tasksFromDb[key].type == type) {	
				
				if (tasksFromDb[key].completed != true && tasksFromDb[key].isDue != false) {  
					var table = document.getElementById('cronHelperTable');
					// insert spacer-row
					var row = table.insertRow(-1);
					var cell1 = row.insertCell(0);
					cell1.style.heigt = "5px";
					cell1.style.backgroundColor = "#dddddd";
					//insert data-row
					var row = table.insertRow(-1);
					var cell1 = row.insertCell(0);
					var i = 0;
					//var j = document.getElementById('cronHelperTable').rows.length; 
					if (tasksFromDb[key].hasOwnProperty("checklist") && tasksFromDb[key].checklist != '') {
						//1st Row: display taskname, type, score u/d
						cell1.innerHTML = '<div class="taskLong">' + tasksFromDb[key].text + '</div>' +
										  '<div class="taskType">' + tasksFromDb[key].type + '</div>' +						  	
										  '<div class="score">' + cronHelperMakeButton(tasksFromDb[key].id, 'up', tasksFromDb[key].type, tasksFromDb[key].up, tasksFromDb[key].down) + '</div>' +
										  '<div class="score">' + cronHelperMakeButton(tasksFromDb[key].id, 'down', tasksFromDb[key].type, tasksFromDb[key].up, tasksFromDb[key].down) + '</div>';
										  
						//2nd ++ Rows display -, checklistItem, Chekclist, score u/d
						for (var checklistKey in tasksFromDb[key].checklist) {
							if (tasksFromDb[key].checklist[checklistKey].completed != true) {
								//var table = document.getElementById('cronHelperTable');
								var row = table.insertRow(-1);
								i++;
								(i  / 2 == Math.round(i / 2)) ? row.style.backgroundColor = "#eeeeee" : row.style.backgroundColor = "#f5f5f5"
								var cell1 = row.insertCell(0); 
								cell1.innerHTML = '<div class="taskShort">-</div>' + 
												  '<div class="checklistItem">' + tasksFromDb[key].checklist[checklistKey].text + '</div>' +
												  '<div class="taskType">Checklist</div>' +
												  '<div class="score">' + cronHelperMakeButton(tasksFromDb[key].checklist[checklistKey].id, 'up', tasksFromDb[key].type) + '</div>' +
												  '<div class="score">' + cronHelperMakeButton(tasksFromDb[key].checklist[checklistKey].id, 'down', tasksFromDb[key].type) + '</div>'; 
							} // end if completed checklist 
							//if (i / 2 != Math.round(i / 2)) {table.insertRow(-1); cell1=row.insertCell(0);}
						} // end for var checklistKey
						
					} else {
						// Task without any checklistItems
						var scoreInfo = '';
						var j = document.getElementById('cronHelperTable').rows.length; 
						if (j / 2 == Math.round(j / 2)) {
							var row = table.insertRow(-1);
							row.insertCell(0);
						}
						
						if (tasksFromDb[key].type == 'habit') {scoreInfo = '<span style="color: #cccccc">(' + tasksFromDb[key].counterUp + '/' + tasksFromDb[key].counterDown + ')</span>'}
						if (tasksFromDb[key].type == 'daily') {scoreInfo = '<span style="color: #cccccc">(' + tasksFromDb[key].streak + ')</span>'}
						
						cell1.innerHTML = '<div class="taskLong">' + tasksFromDb[key].text + scoreInfo + '</div>' +
										  '<div class="taskType">' + tasksFromDb[key].type + '</div>' +						  	
										  '<div class="score">' + cronHelperMakeButton(tasksFromDb[key].id, 'up', tasksFromDb[key].type, tasksFromDb[key].up, tasksFromDb[key].down) + '</div>' +
										  '<div class="score">' + cronHelperMakeButton(tasksFromDb[key].id, 'down', tasksFromDb[key].type, tasksFromDb[key].up, tasksFromDb[key].down) + '</div>';
					}
				} // end if completed	
			} // end if tasksFromDb 
		} // end for var key in tasksFromDb
	} // function output(type);
} // end function cronHelper
async function callForceCron() {
	// fetch the user's own content (again) to determine if user needsCron:
	async function getUserData() {
		$('#modalContent').html('Please wait, re-fetching user data from Habitica... ');
		$('#modal').show();
		let result;  
		try {
			result = await $.ajax({	
				url: 'https://habitica.com/api/v3/user',
				type: 'GET',
				dataType: 'json',
				cache: false,
				beforeSend: function(xhr){
					xhr.setRequestHeader('x-client', '9226cae6-d852-45da-a51b-ec2c9cb759e6-Habitican Wardrobes');
					xhr.setRequestHeader('x-api-user', userID);
					xhr.setRequestHeader('x-api-key',  apiToken);
				},
				success: function(result){console.log("User loaded!"); user = result.data}
			});
		return user;
		} catch (error) {
			console.log(error.responseText);
		}
	} // end async function getUserData
	
	if (user.needsCron == false) {
		$('#modalContent').html('Your Cron has not yet taken place.<br>Please try later!');
		$('#modal').show();
		setTimeout(function(){$('#modal').hide()}, 3000);
		return; 
	} else {
		
		if (cronHelperWardrobeForCron == 'disabled' && !wardrobeEquipped.includes('intelligence')) {
			if (confirm('You are going to run Cron with your individually selected Battle Gear.'+ 
						'You might want to change to wardrobe Intelligence to gain more mana.' +
						'\n\nPlease be aware that after changing to wardobe Intelligence, there is ' +
						'no way to determine your previously selected gear.\n\nDo you want to proceed with your current gear?')){
				if (confirm('This will run Cron. Are all of your completed tasks ticked off?\n\n Are you sure you want to proceed?')) {
					await doAjax('https://habitica.com/api/v3/cron');
					fetchData(); 
				} else {
					alert('Action cancelled');
					return;
				}
			} else {
				alert('Action cancelled.'); 
				return; 
			} 	
		} else {
			if (confirm('This will run Cron. Are all of your completed tasks ticked off?\n\n Are you sure you want to proceed?')) {
				if (!wardrobeEquipped.includes('intelligence')) { await callWardrobe('intelligence');}
				await doAjax('https://habitica.com/api/v3/cron');
				fetchData();
			}
		}
	} // end if user.needsCron
} // end async function callForceCron
/////////////////////////////////////////////////
/////////////////////////////////////////////////
///////////////// Buttons ///////////////////////
/////////////////////////////////////////////////
	 
	// $('#buttons').html(buttons);
	 
	 $(document).click(function(event) {
	 
			var eclass = $(event.target).closest().prevObject[0].className; 
			var eid = $(event.target).closest().prevObject[0].id;
			var row = $(event.target).parents('tr').index(); 
	 		
		
			// determine which row / column was clicked ... (cronHelper)
			//$("#cronHelperTable td").click(function() {  
			  
				if (eclass == 'up' || eclass == 'down') {
					//console.log(' score : col: '+ column_num + ' id: ' + eid + ' line ' + r + 'this: ' + JSON.stringify($(this).parents(1).index()));
					
					
					scoreTaskDoAjax(eid, eclass, row);
					} // end if  eclass up or down		
				
			//}) // end $cronHelperTable click
	 		
		
			
	 		
			
			// modals
			//if you click on anything except the modal itself or the "open modal" link, close the modal
 			if ($(event.target).closest("#modalDataContent, #TAS, #HCT, #USR, #SKL, #DGR, #PAR").length == 0) {
				$('#modalData').hide();
				$('#modalPary').hide();
			}
			if ($(event.target).closest('#modalHelpContent, #HLP').length == 0) {
				$('#modalHelp').hide();
			}
			if ($(event.target).closest("#modalSettingsContent, #SET").length == 0) {
				$('#modalSettings').hide();
			}
			if ($(event.target).closest("#modalVersionContent, #VER").length == 0) {
				$('#modalVersion').hide();
			}
			if ($(event.target).closest('#modalCronHelperContent, #CRO, #forceCron').length == 0){
				$('#modalCronHelper').hide();
			}
				
			if ($(event.target).closest(".close").length == 1) {
				$('#modal').hide();
				$('#modalData').hide();
				$('#modalSettings').hide();
				$('#modalVersion').hide();
				$('#modalHelp').hide();
				$('#modalCronHelper').hide();
				$('#modalParty').hide();
				}	
	 });
	 $('#HCT').click(function(){
	 			$('.dataSectionxy').html(
				'<div>This is Habitica\'s content: <br><pre><span style="font-size: x-small">' + 
				JSON.stringify(content, null, 4) +  
				'</span></pre></div>');
				$('#modalData').show(); 
				});
	 $('#USR').click(function(){
	 			$('.dataSectionxy').html(
				'<div>This is your user profile: <br><pre><span style="font-size: x-small">' + 
				JSON.stringify(user, null, 4) +  
				'</span></pre></div>');
				$('#modalData').show(); 
				});
	 $('#SKL').click(function(){	 
		 		$('.dataSectionxy').html(
				'</span><div>These are your skills: <br><pre><span style="font-size: x-small">' + 
				JSON.stringify(skills[user.stats.class], null, 4) +  
				'</pre></div>');
				$('#modalData').show(); 
				});  
	 $('#PAR').click(function(){
	 			partyCronTimes();
	 			})
	 $('#CRO').click(function(){
	 			cronHelper();
	 			$('#modalCronHelper').show();
	 			})	 
	 $('#TAS').click(function(){
	 			var showHistory = $('#showHistory').is(':checked');
				if (showHistory != true) {
					var output = JSON.parse(JSON.stringify(tasksFromDb)); 
					for (var key in output) {
						if (output[key].hasOwnProperty("history")) {
							delete output[key].history; 
						}
					} 				
					$('.dataSectionxy').html(
					'<div>These are your tasks: <br><pre><span style="font-size: x-small">' + 
					JSON.stringify(output, null, 4) +  
					'</span></pre></div>');
				} else {
					$('.dataSectionxy').html(
					'<div>These are your tasks: <br><pre><span style="font-size: x-small">' + 
					JSON.stringify(tasksFromDb, null, 4) +  
					'</span></pre></div>');
				} 
				$('#modalData').show();  
				});
	 $('#SET').click(function(){
	 			$('#modalSettings').show();
				});		
	 $('#VER').click(function(){
	 			$('#modalVersion').show();
				});
	 $('#ICO').click(function(){
				$('.dataSectionx').html(
				'<div>This is your avatar: <br>' +   
				loadAvatar() +
				'</div>');
				$('#modalData').show(); 
				});
	 $('#INT').click(function(){
	 			htmlEnd = '<div>Wardrobe INT <br>';
				callWardrobe(intelligence, "Intelligence");
				htmlEnd += '</div>';
				$('#displayContent').html(htmlEnd);
				});
	 $('#PER').click(function(){
	 			htmlEnd = '<div> Wardrobe PER <br>';
				callWardrobe(perception, "Perception");
				htmlEnd += '</div>';
				$('#displayContent').html(htmlEnd);
				});
	  $('#CON').click(function(){
	 			htmlEnd = '<div> Wardrobe CON <br>';
				callWardrobe(constitution, "Constitution");
				htmlEnd += '</div>';
				$('#displayContent').html(htmlEnd);
				});
	 $('#LEG').click(function(){
	 			htmlEnd = '<div>Wardrobe Legendary Equipment <br>';
				callWardrobe(legendary, "Legendary");
				htmlEnd += '</div>';
				$('#displayContent').html(htmlEnd);
				});
	 $('#BLE').click(function(){
	 			htmlEnd = '<div>Wardrobe Blessing (CON + INT) <br>';
				callWardrobe(blessing, 'Blessing');
				htmlEnd += '</div>';
				$('#displayContent').html(htmlEnd);
				});		
	 $('#STR').click(function(){
	 			htmlEnd = '<div>Wardrobe Strength <br>';
				callWardrobe(strength, 'Strength');
				htmlEnd += '</div>';
				$('#displayContent').html(htmlEnd);
				});	
	$('#HLP').click(function(){
				$('#modalHelp').show();
				}); // end of click
	$('#DGR').click(function(){
			getMaxGear();
			var displayGear='<div>This is your gear:</div><span style="font-size: x-small">' +
							'<div><pre>Best INT Gear: ' + JSON.stringify(intelligence, null, 4) + '</pre></div>' +
							'<div><pre>Best PER Gear: ' + JSON.stringify(perception, null, 4) + '</pre></div>' +
							'<div><pre>Best STR Gear: ' + JSON.stringify(strength, null, 4) + '</pre></div>' +
							'<div><pre>Best CON Gear: ' + JSON.stringify(constitution, null, 4) + '</pre></div>' +
							'<div><pre>Best Blessing Gear: ' + JSON.stringify(blessing, null, 4) + '</pre></div>' +
							'<div><pre>Initial Gear HB: ' + JSON.stringify(user.items.gear.equipped, null, 4) + '</pre></div>' +
							'<div><pre>Initial Gear JS: ' + JSON.stringify(initialGear, null, 4) + '</pre></div>';
							'<div><pre>Legendary Gear: ' + JSON.stringify(legendary, null, 4) + '</pre></div></span>';
			$('.dataSectionxy').html(displayGear);
			$('#modalData').show();
			}); // end of click
	$('#RFR').click(function(){
			fetchData();
			}); // end of click
	$('#forceCron').click(function(){
		callForceCron(); 	 	
		});
	$('#toggleFrontEnd').click(function(){	
		frontEnd = storeData("FrontEnd"); 
		if (frontEnd == null) {frontEnd = "wardrobes"; }
		if (frontEnd == "wardrobes") {
			$('.wardrobes-Container').hide();
			$('.skills-Container').show(); 
			storeData("FrontEnd", "skills"); 
  			}
		if (frontEnd == "skills") {										
			$('.skills-Container').hide(); 
			$('.wardrobes-Container').show();
			storeData("FrontEnd", "wardrobes");
  			}
		frontEnd = storeData("FrontEnd"); 
		})
	// buttons in the skill-FrontEnd
	$('.add').click(function () {
		if ($(this).prev().val() < 20) {
    		$(this).prev().val(+$(this).prev().val() + 1);
		}
		
		
		})
	$('.sub').click(function () {
		if ($(this).next().val() > 1) {
    		if ($(this).next().val() > 1) $(this).next().val(+$(this).next().val() - 1);
		}
		})
	$('#castSkill1').click(function () {
		storeData('skill1', JSON.stringify(document.querySelector('#amount1').value));
		amountOfSkill = getAmountOfSkill("field1"); 
		prepareTriple(amountOfSkill,
				  skills[user.stats.class].field1.API, 
				  skills[user.stats.class].field1.name,
				  skills[user.stats.class].field1.cost,
				  skills[user.stats.class].field1.wardrobe,
				  skills[user.stats.class].field1.nameOfWardrobe, 
				  'field1');	
		})		
	$('#castSkill2').click(function () {
		storeData('skill2', JSON.stringify(document.querySelector('#amount2').value));
		amountOfSkill = getAmountOfSkill('field2'); 
		prepareTriple(amountOfSkill,
				  skills[user.stats.class].field2.API, 
				  skills[user.stats.class].field2.name,
				  skills[user.stats.class].field2.cost,
				  skills[user.stats.class].field2.wardrobe,
				  skills[user.stats.class].field2.nameOfWardrobe, 
				  'field2');	
		})
	$('#castSkill3').click(function () {
		storeData('skill3', JSON.stringify(document.querySelector('#amount3').value));
		amountOfSkill = getAmountOfSkill('field3'); 
		prepareTriple(amountOfSkill,
				  skills[user.stats.class].field3.API, 
				  skills[user.stats.class].field3.name,
				  skills[user.stats.class].field3.cost,
				  skills[user.stats.class].field3.wardrobe,
				  skills[user.stats.class].field3.nameOfWardrobe, 
				  'field3');	
		})
	$('#castSkill4').click(function () {
		storeData('skill4', JSON.stringify(document.querySelector('#amount4').value));
		amountOfSkill = getAmountOfSkill('field4'); 
		prepareTriple(amountOfSkill,
				  skills[user.stats.class].field4.API, 
				  skills[user.stats.class].field4.name,
				  skills[user.stats.class].field4.cost,
				  skills[user.stats.class].field4.wardrobe,
				  skills[user.stats.class].field4.nameOfWardrobe, 
				  'field4');	
		})
	$('#threshold').on('change', function(){
		threshold = $('#threshold').prop('value'); // value comes as a string form <option>
		storeData('Hard Mode', threshold); // ... needs to be stored as a string
		threshold = parseInt(threshold); // ... but needs to be number for the following code
		//parseData();
		}); 
		$('#alternativeAttribute').on('change', function(){
		alternativeAttribute = $('#alternativeAttribute').prop('value'); // value comes as a string form <option>
		storeData('Alt. Attribute', alternativeAttribute); // ... needs to be stored as a string
		//parseData();
		}); 
	$('#forceAetherAmuletAndComicalArrow').click(function(){
		forceAetherAmuletAndComicalArrow = JSON.stringify($('#forceAetherAmuletAndComicalArrow').is(':checked'));
		storeData('Amulet and Arrow', forceAetherAmuletAndComicalArrow);
		console.log(forceAetherAmuletAndComicalArrow);
		//parseData();
		})	
	$('#cronHelperWardrobeForTasks').on('change', function() {
		cronHelperWardrobeForTasks = $('#cronHelperWardrobeForTasks').prop('value');
		storeData('Tasks', cronHelperWardrobeForTasks);
		console.log(cronHelperWardrobeForTasks);
	})
	$('#cronHelperWardrobeForCron').on('change', function() {
		cronHelperWardrobeForCron = $('#cronHelperWardrobeForCron').prop('value');
		storeData('Cron', cronHelperWardrobeForCron);
	})	
	$('#rememberGear').click(function(){	
		rememberGear = JSON.stringify($('#rememberGear').is(":checked")); 
		storeData("Remember Gear", rememberGear);
		console.log(rememberGear);
		})
	
    //////////////////////////////////////////////////////////////////////
    ////   Display the HTML    (within paseData)   ///////////////////////
    //////////////////////////////////////////////////////////////////////
	$('#documentationAndForm').html(' ');
    $('#modal').hide();
    $('#output').html(htmlStart + html + htmlEnd);
	prepareSkillAmounts();
	(frontEnd == 'wardrobes') ? $('.skills-Container').hide() : $('.wardrobes-Container').hide();
	
	
} // End of parseData() and its nested functions
}); // end of global Function
</script>
<style>
/*********************************************************************
****   Page-wide   ***************************************************
*********************************************************************/
body {
	font-family: Helvetica, Arial, sans-serif;
    font-size: 14px;
    background-color: #4f2a93;
	color: #000000;
}
#outerFrame {
	margin: 0px;
	background-color: #4f2a93;
}
#innerBody {
    margin: 5px;
    padding: 5px; 
    background-color: #eeeeee;
	color: #000000;
	border-radius: 8px;
	min-width: 605px; 
}
#loading {
    margin-right: 30px;
    margin-left: 30px;
    color: orange;
    font-size: 1.5em;
    font-weight: bold;
}
div.scroll {
    width: 95%;
    height: 200px;
    overflow: scroll;
}
#headerExtras .showHideToggle {
    white-space: nowrap;
}
.show {
    display: block;
}
.hide {
    display: none;
}
.clear {
    clear: both;
}
.leftSide {
	position: absolute;
	float: left;
	left: 0px;
}
.rightSide {
	position: absolute; 
	float: right;
	right: 0px;
}
.topSide {
	vertical-align: text-top;
	top: 0px;
}
.bottomSide {
	vertical-align: text-bottom;
	bottom: 0px;
}
.wardrobes-Container {
  display: flex;
  flex-wrap: wrap;
  background-color: #dddddd;
  line-height: 250px;
  border-radius: 8px;
}
.wardrobes-Container>div {
  background-color: #eeeeee;
  border-radius: 8px;
  width:280px;
  margin: 10px;
  border: 10px;
  text-align: left;
  line-height: 13px;
  font-size: 12px;
}
.skills-Container {
  display: flex;
  flex-wrap: wrap;
  background-color: #dddddd;
  line-height: 250px;
  border-radius: 8px;
}
.skills-Container>div {
  background-color: #eeeeee;
  border-radius: 8px;
  width:280px;
  margin: 10px;
  border: 10px;
  text-align: center;
  line-height: 13px;
  font-size: 12px;
}
.flex-displayContent {
	background-color: #eeeeee;
	display: flex;
	flex-wrap: wrap;
	margin: 10%
	width: 100%;
	height: 200px;
	overflow: scroll;
}
.flex-displayContent>div {
	width: 50%;
	margin: 10px;
	border: 10px;
	text-align: left;
	overflow:scroll;
}
/***************************
******Attriute Containers **
****************************/
.container {
    width: 97%;
    height: 80px;
    color: #4e4a57;
    margin: auto;
    padding: 0;
	border-radius: 8px;
}
.one {
    width: 47%;
    height: 70px;
	float: left;
	border-radius: 8px;
	border-style: solid;
	border-width: 3px;
	border-color: #ffffff
	
}
.two {
	width: 47%;
    margin-left: 50%;
    height: 70px;
	align: left;
	border-radius: 8px;
	border-style: solid;
	border-width: 3px;
	border-color: #ffffff
}
.innerContainer {
    width: 100%;
    height: 70px;
    background: #ffffff;
    margin: auto;
    padding: 0px;
	color: #4e4a57;
	font-family: "Roboto",sans-serif;
	
}
.innerOne {
	text-transform: uppercase;
	text-align: center;
	vertical-align: 5px;
	font-size: large;
    width: 45%;
    height: 70px;
    background: #ffffff;
	color: #4e4a57;
	float: left;
	
}
.innerTwo {
	font-size: x-small;
    margin-left: 45%;
    height: 70px;
    background: #ffffff;
	color: #4e4a57;
}
.containerMana {
    border-radius: 8px;
	width: 92%;
    height: 110px;
    color: #4e4a57;
    margin: auto;
    padding: 8px;
	background: #efffff;
	font-family: "Roboto",sans-serif;
}
.left {
    width: 58%;
    
	float: left;
}
.middle {
	width: 20%;
	text-align: right;
	float: left;
}
.right {
	width: 18%;
    margin-left: 76%;
	text-align: right;
	align: left;
}
.skills {
    width: 47%;
    height: 80px;
	float: left;
	border-radius: 8px;
	border-style: solid;
	border-width: 3px;
	border-color: #ffffff
	
}
.mana {
	width: 47%;
    margin-left: 50%;
    height: 80px;
	align: left;
	border-radius: 8px;
	border-style: solid;
	border-width: 3px;
	border-color: #ffffff
}
/***************************
*** IMG hovers *************
***************************/
.wrap {
  position: relative;
  
}
.description {
  border-radius: 8px;
  position: absolute;
  float: left;
  top: -45px;
  left: -10%;
  right: -10%;
  font-weight: normal;
  color: #333333;
  visibility: invisible;
  opacity: 0;
  background-color: #fefefe;
  margin: 1em auto 1em auto;
  padding: 5px;
  border: 1px solid #888888;
  width: 90px;
  min-width: 90px;
  max-width: 90px;
  z-index: 2;
}
.descriptionStats {
  border-radius: 8px;
  position: absolute;
  top: 5px;
  left: 90px;
  right: 50px;
  font-weight: normal;
  color: #333333;
  visibility: invisible;
  opacity: 0;
  background-color: #fefefe;
  margin: auto;
  padding: 20px;
  border: 1px solid #888888;
  width: 150px;
  z-index: 2;
}
.descriptionSkills {
  border-radius: 8px;
  position: absolute;
  bottom: 30px;
  left: -8px;
  font-weight: normal;
  color: #333333;
  visibility: invisible;
  opacity: 0;
  background-color: #fefefe;
  margin: auto;
  padding: 0px;
  border: 1px solid #888888;
  width: 280px;
  z-index: 2;
}
.wrap:hover .description {
  visibility: visible;
  opacity: 1;
}
.wrap:hover .descriptionStats {
  visibility: visible;
  opacity: 1;
}
.wrap:hover .descriptionSkills {
  visibility: visible;
  opacity: 1;
}
/***********************************
quantity buttons
***************/
.number {
	width: 20px; 
}
/**********************************************************************
****** Modal **********************************************************
**********************************************************************/
/* modal und modal-content for short info about equipping gear, casting skills etc. */
/* The Modal (background) */
.modal {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 5; /* Sit on top */
    padding-top: 100px; /* Location of the box DO WE NEED THIS?*/
    left: 0;
    top: 0;
	width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: auto; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}
/* Modal Content */
.modal-content {
	position: absolute; 
	left: 50%;
	top: 32%;
	transform: translate(-50%, -50%);
	border-radius: 8px;
    background-color: #fefefe;
    margin: auto;
    padding: 20px;
    border: 1px solid #888;
    width: 300px;
	font-weight: bold;
	text-align: center; 
}
/* modalData and modalData-content for big modals (tasks, skills, content, user, version info, help */
/* The Modal (background) */
.modalData {
    display: none; /* Hidden by default */
    position: fixed; /* Stay in place */
    z-index: 4; /* Sit on top, even on top of Tooltips*/
    padding-top: 100px; /* Location of the box DO WE NEED THIS?*/
    left: 0;
    top: 0;
	width: 100%; /* Full width */
    height: 100%; /* Full height */
    overflow: hidden; /* Enable scroll if needed */
    background-color: rgb(0,0,0); /* Fallback color */
    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
}
/* Modal Content */
.modalData-content {
	position: fixed;
    bottom: 5%;
    left: 10%;
    width: 80%;
    height: 90%;
	min-width: 80%;
	max-width: 600px; 
	border-radius: 8px;
	background-color: #fefefe; 
    border: 2px solid #eeeeee;
	z-index: 4; 
}
/* cronHelper */
.cornHelperTable {
	border-collapse: collapse;
	width: 100%;
	border: 10px;
	border-left-width: 10px;
	border-top-style: none;
	border-right-style: none;
	border-left-style: 5px;
	border-color: #eeeeee;
	
}
.top {
  overflow: hidden;
  background-color: #eeeeee;
  color: #222222;
  top: 0;
  height: 80px;
  max-height: 200px;
  width: 100%;	
}
.dataSectiony {
	overflow-y: auto;
	overflow-x: hidden;
	position: relative;
	min-height: cals(90vh - 160px);
	max-height: calc(90vh - 160px);
}
.dataSectionxy {
	overflow-y: auto;
	overflow-x: auto;
	position: relative;
	min-height: calc(90vh - 160px);
	max-height: calc(90vh - 160px);
}
.dataSectionFix {
	overflow-y: auto;
	overflow-x: auto;
	position: relative;
	min-height: calc(90vh - 160px);
	max-height: calc(90vh - 160px);
}
.bottom {
	overflow: hidden;
	bottom: 0px;
	width: 100%;
	height: 80px;
	background-color: #eeeeee;
}
/* The Close Button */
.close {
  color: #aaaaaa;
  float: right;
  font-size: 28px;
  font-weight: bold;
}
.close:hover,
.close:focus {
  color: #000;
  text-decoration: none;
  cursor: pointer;
}
/*********************************************************************
****   Header   ******************************************************
*********************************************************************/
h1 {
    float: left;
	font-size: 1.5em;
}
h1>a:first-child { /* "Habitica" link in header */
    color: black;
    text-decoration: none;
}
h1>a:first-child:hover { /* "Habitica" link in header */
    text-decoration: underline;
}
h1 span {
    font-size: 0.5em;
}
/************************************************
***** top navigation ****************************
************************************************/
/*
body {
  font-family: Arial, Helvetica, sans-serif;
}
*/
.navbar {
  overflow: hidden;
  background-color: #eeeeee;
}
.navbar a {
  float: left;
  font-size: 16px;
  color: 662266;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;
}
.navbar b {
  float: left;
  font-size: 16px;
  color: #662266;
  text-align: center;
  padding: 14px 16px;
  text-decoration: none;	
}
.dropdown {
  float: left;
  overflow: hidden;
}
.dropdown .dropbtn {
  font-size: 16px;  
  border: none;
  outline: none;
  color: #662266;
  padding: 14px 16px;
  background-color: inherit;
  font-family: inherit;
  margin: 0;
}
/*
.navbar a:hover, .dropdown:hover .dropbtn {
  background-color: #662266;
  color: white; 
}
*/
.topnav-right {
  float: right;
}
.small {
	font-size: 8px;
	margin: 1px; 
}
.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f9f9f9;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 3;
}
.dropdown-content a {
  float: none;
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
  text-align: left;
}
.dropdown-content a:hover {
  background-color: #ddd;
}
.dropdown:hover .dropdown-content {
  display: block;
}
/*////////////////////////////
/// Output Members' last cron
/////////////////////////////*/
table {
  font-family: arial, sans-serif;
  border-collapse: collapse;
  width: 100%;
}
td, th {
  text-align: left;
  padding: 8px;
}
/*///////////////////////////////
/// Cron Helper Table ///////////
////////////////////////////////*/
.taskType {
	float: left;
	width: 15%;
}
.score {
	float: left;
	width: 30px;
}
.taskLong {
	float: left;
	width: 70%;
}
.taskShort {
	float: left;
	width: 15%;
	
}
.checklistItem {
	float: left;
	width: 55%;
}
</style>

</head>


<body>
	<!-- Modals -->
		<!-- small info modal for info about: loading, casting skills, equipping gear, etc.  -->
		<div id="modal" class="modal">
  			<div id="modalContent" class="modal-content"></div>
		</div>	

		<!-- modal for the separate Settings-page -->
		<div id="modalSettings" class="modalData">	
			<div id="modalSettingsContent" class="modalData-content" style="background-color: rgba(250,250,250,0.85)">
				<div class="top">
					<span class="leftSide">Settings:</span>
					<span class="close">&times; &nbsp;</span>
				</div>
				<div class="dataSectionFix">
					<p>Automatic Selection of Gear:</p>
					<p>Set threshold
						<select id="threshold" onchange="console.log(value)">
							<option value="1">1</option>
							<option value="2">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8">8</option>
							<option value="9">9</option>
						</select>
					</p>
					<p style="font-size: x-small">
						All wardrobes are pre-filled with the users Habitica-side chosen Battle Gear. <br>
						Pre-filled gear is replaced by equipment from inventory with values exceeding the threshold.<br>
						Choosing a low threshold will allow the wardrobes to be aligned to maximum attribute points, even at the expense of other important attributes.<br>
						At a high threshold, the maximum yield of attribute points is not achieved, but other important attributes are more likely maintained.<br>     
					</p>
					<p>Set alternative attribute: 
						<select id="alternativeAttribute" onchange="console.log(value)">
							<option value="none">-none-</option>
							<option value="int">Intelligence</option>
							<option value="per">Perception</option>
							<option value="str">Strength</option>
							<option value="con">Constitution</option>
						</select>
					</p>
					<p style="font-size: x-small">
						An alternative attribute can be selected to exchange equipment with values below the threshold for equipment with different attributes.       
					</p>	
					
					<p>Force Aether Amulet and Comical Arrow<input id="forceAetherAmuletAndComicalArrow" type="checkbox" autocomplete="off" /></p>
					<p style="font-size: x-small">
						Both Aether Amulet and Comical Arrow provide high attribute points for STR. Regardless of other setting, "force Aether Amulet and Comical Arrow" 
						equips both items, provided they are in the iventory. This does not apply to wardrobe PER.        
					</p>	
					<hr>
					<p>Cron Helper: </p>
					<p>Wardrobe for Tasks: 
					  <select id="cronHelperWardrobeForTasks" onchange="console.log(value)">
  						<option value="disabled">-disabled-</option>
						<option value="intelligence">Intelligence</option>
						<option value="perception">Perception</option>
						<option value="strength">Strength</option>
						<option value="Legendary">Legendary</option>
					  </select>
					</p>
					<p style="font-size: x-small">
						Cron Helper can change wardrobes when scoring tasks automatically, depending on the setting made here. <br> 
						For players who do not wish to change equipment using the Cron Helper, this procedure can be disabled. <br> 
						CAUTION: Scoring tasks with the help of automated change of wardrobes will change the users battle gear. Once equipped, there is no way to determine previous state!       
					</p>
					<p>Wardrobe for Cron: 
					  <select id="cronHelperWardrobeForCron" onchange="console.log(value)">
  						<option value="disabled">-disabled-</option>
						<option value="intelligence">Intelligence</option>
						</select>
					</p>
					<p style="font-size: x-small">
						Cron Helper can change wardrobes when running cron automatically, depending on the setting made here. <br> 
						For players who do not wish to change equipment using the Cron Helper, this procedure can be disabled. <br> 
						CAUTION: Running cron with the help of automated change of wardrobes will change the users battle gear. Once equipped, there is no way to determine previous state!       
					</p>
			
					<hr>
					<p>Show History on Data\Tasks: <input id="showHistory" type="checkbox" autocomplete="off" /><span style="font-size: x-small">(Initially hidden for better view)</span></p>
					<hr>
					<p></p>
										
				</div>					
			</div>
		</div>

		<!-- modal for data display: tasks, user-data, wardrobes, skills, Habitica content -->
		<div id="modalData" class="modalData">	
			<div id="modalDataContent" class="modalData-content">
				<div class="top">
					<span class="leftSide">Habitica Data</span>
					<span class="close">&times; &nbsp;</span>
				</div>
				<div class="dataSectionxy">
					main content here	
				</div>
				<div class="bottom"> 
					<span class="leftSide bottomSide">
						To close, click x or outside this window 
					</span>
					<span class="rightSide bottomSide">
						&nbsp;
					</span> 
				</div>
			</div>
		</div>

		<!-- modal for Cron Helper page -->
		<div id="modalCronHelper" class="modalData">	
			<div id="modalCronHelperContent" class="modalData-content">
				<div class="top">
					<span class="leftSide topSide">Habitica Cron Helper</span>
					<span class="close">&times; &nbsp;</span>
					<table>
						<tr>
							<div style="position: absolute; font-weight: bold; top: 50px; width: 95%">
							<div class="taskShort">Task</div>
							<div class="checklistItem">Checklist</div>
							<div class="taskType">Type</div>
							<div class="score"><button style="border-radius: 10px; border-style: none" class="up">+</button></div>
							<div class="score"><button style="border-radius: 10px; border-style: none" class="down">-</button></div>
							<div class="score" style="width: 14px;">&nbsp;</div>
							</div>
						</tr>
					</table>
				</div>
				<div class="dataSectionFix cronHelperTable">
					<table id="cronHelperTable" class="cronHelperTable">
 			 			<tr>
   							<div class="taskShort"></div>
							<div class="checklistLong"></div>
    						<div class="taskType"></div>
							<div class="score"></div>
							<div class="score"></div>
	    				</tr>
					</table>
				</div>
				<div class="bottom"> 
					<span id="cronHelperInfo" class="leftSide bottomSide">
						Please check, if you are wearing the correct wardrobe<br>
						before scoring a task or before forcing cron.<br> 
					</span>
					<span class="rightSide bottomSide">
						<button id="forceCron" 
							style="border-radius: 8px; 
								   border: none;
								   background-color: green; 
								   color: white; 
								   font-size: large;">
							Force Cron
						</button>
						&nbsp;
					</span> 
				</div>
			</div>
		</div>

		
		<!-- model for help-window -->
		<div id="modalHelp" class="modalData">	
			<div id="modalHelpContent" class="modalData-content">
				<div class="top">
					<span class="leftSide">Habitican Wardrobes - Help</span>
					<span class="close">&times; &nbsp;</span>
				</div>
				<div class="dataSectionFix">
					<ol style="list-style-position: outside;"> 
						Help: <br><br>
						<li>Habitican Wardrobes is a HTML-File using Javascript. <br>The code can be found on 
						<a href="https://github.com/PitiTheGrey/Habitican-Wardrobes">Github</a></li>
						<li>There is a <a href="https://habitica.com/groups/guild/ba3e642f-a109-4ad2-b041-301c2935189f">Habitican Wardrobes Guild</a> 
						on Habitica to discuss feature requests, report bugs, ask questions, give feedback and alike. </li>
						<li>Please feel free to read the <a href="https://habitica.fandom.com/wiki/Habitican_Wardrobes">wiki page</a> about Habitican Wardrobes and the 
						<a href="https://habitica.fandom.com/wiki/Cron-Helper">Cron Helper</a>.</li>
					</ol>	
				</div>
				<div class="bottom"> 
					<span class="leftSide bottomSide">
						To close, click x or outside this window 
					</span>
					<span class="rightSide bottomSide">
						&nbsp;
					</span> 
				</div>
			</div>
		</div>

		<!-- modal for version-info -->
		<div id="modalVersion" class="modalData">	
			<div id="modalVersionContent" class="modalData-content">
				<div class="top">
					<span class="leftSide">Habitican Wardrobes and Cron Helper version info:</span>
					<span class="close">&times; &nbsp;</span>
				</div>
				<div class="dataSectionFix">
					<h3>Version Info:</h3><br><br>
			    	<ol style="list-style-position: outside;"> 
					<h4>Version 2.1</h4><br>
					<li>
						'Cron Helper' allows you to take care of all of your accidentally unchecked task entries, even though Habitica's cron time has already expired.<br>
						After all desired tasks have been ticked off, the cron process can be triggered via the 'force cron' button. It's required that Habitica's cron time has already expired, though.
						<br>
						The Cron Helper is integrated into Habitican Wardrobes to take advantage of the appropiate wardrobes for runnung cron and checking off tasks.<br>
					</li>
					<li> 
						The menu item 'Data' now contains the entry 'Party-Cron-Times'. 'Party Cron Times' displays a list of your party members and their most recent 
						cron time. <br>
						This information may be useful to decide when a skill should be used. You may want to wait for the next party member to cron, before you 
						cast your party buffs.  
					</li>
					<li>
						The Hard-Mode button has been replaced by a selection box. Values between 1 and 9 can now influence whether the wardrobe should reach the maximum number 
						of attribute points, or wheter other properties can better be retained.  <br>
						Hand in hand with the selection field for the threshold, the program logic for the selection of the best equipment for a wardrobe has been revised.<br>
						Every wardrobe is prefilled with the users' current equipment. Only better equipment will be added if it is above the threshold. <br>
						On the Settings page, you can set an alternative property to search for if the threshold set causes undesirable results.
					</li>
					<li>Several modals have been optically refreshed and screen design has been given a little lifting in regards to mobile devices</li>
					
					<br>
					<br> 
  			 		<h4>Version 2.0</h4><br>
			   	 	<li>
						You can now toggle the display between Wardrobes and Skills. 
					</li>
			   	 	<li>
						The new Skills-section allows you to cast any of your four skills with an adjustable number of repititions.
					</li>
			   	 	<li>
						Values (repititions, Hard-Mode, selcted FrontEnd) are stored either in your browsers Local-Storage or in a local cookie if there is no 
						Local-Storage (if you use Edge as browser e.g.). All values will still be present after a page reload or a complete browser restart. 
						Check any search-engine on how to clean local Storage to delete entries by hand. 
					</li>
   					<li>Amount of repitition will automatically be reduced if Mana-level is too low.</li>
   					<li>Skills cannot be cast if your level is too low for the specific skill. </li>
					<li>
						The website uses the best suitable wardrobe for your chosen skill and returns to wardrobe Intelligence when all skills are completed. <br>
						Plans are to let you specify a wardrobe to return to. 
					</li>
					<li>
						Skills that are cast on tasks will be cast on your bluest task (highest positive value). <br>
						Warriors who might want to make a red tast more blue, will unfortunately have to wait for a future version where they can choose an 
						individual target.<br>
   						It is not possible to cast skills on tasks from challenges. 
					</li>
   					<li>Some buttons were relocated to a new navigation bar on the top of the page for easier access and better looks. </li>
   					<li>Display of information about gear, user-data, Habitica-content, tasks, etc. now uses modals for an optimized field of view. </li>
   					<li>
						The API section needed major adjustments and was redesigned completely. <br>
   						The use of deferred promises could no longer be maintained and had to be replaced by async await functions in order to sequentially go 
						through the chain of ajax-calls. 
					</li>
   					<li>xhr-headers for server-requests now contain the name of the tool and the authors user-id.</li>
   					<li>
						There are wait-functions between API-Server-Calls to minimize server-load. <br>
 	  					The more skills are cast, the longer the waiting time between calls will be. The formula is (1000+(1000 * amount / (0.01 * amount + 20))) 
						in milli-seconds. So code waits 1.5 sec each on 10 casts, 3.5 sec each on 50 casts and 11 sec each on 200 casts. 
					</li> 
 	  				<li>Adjustments of some z-index</li>
 	  				<li>Adjustments of disclaimer for legal compatibility with local law in conjunction with data-processing</li>
					<br>
 	 		 		<br> 
  			   		<h4>Version 1.4</h4><br>
			   		Hard Mode - button added. Default value is disabled - showing gear with compromise in some cases. <br>
   					Activating Hard Mode will provide best gear at any cost. <br><br>
   					Version 1.3.5<br>
   					Tooltips added for Skills in order to give more precise information. <br>
   					Refresh-button moved to top of the page for accessability. <br>
   					Counters added to "lodading" and "equipping" modals. <br>
   					<br>
   					Version 1.3<br>
   					Class-specific Impacts of skills were added for all classes.<br>
   					This version allows for entry level players<br>
   					Bug-fixes: <br>
  	 				Empty inventory sports are no longer shown. <br>
  	 				In case multiple wardrobes contain the same inventory, all those wardrobes are displayed with a boarder. <br>
   					Corrected focus for Tooltips for information about gear <br> 
   					undefined situations in gear fixed<br>
   					euip-function was adjusted to match exact number of items in each wardrobe<br>
   					<br>
   					Version 1.2<br>
   					Two-handed weapons were implemented.  <br>
   					code was overhauled. <br>
   					<br>
		   			<br>
		   			old Version 1.1<br>
					Fixed bug:  Items that were lost due to death were suggested in the wardrobe, and couldn't be equipped. 
					</ol>	
				</div>
				<div class="bottom"> 
					<span class="leftSide bottomSide">
						To close, click x or outside this window 
					</span>
					<span class="rightSide bottomSide">
						&nbsp;
					</span> 
				</div>
			</div>
		</div>
	<!-- end Modals section -->

	<div id="innerBody">
		<h1>Habitican Wardrobes<br>
			<span>(v 2.1 August 2019)</span>
		</h1>
		<div id="headerExtras"></div>
		<hr class="clear" />
		<div id="loading">
    		<div class="good hide">
        			<p>Please wait. Syncronizing with Habitica server...</p>
    		</div>
    		<div class="bad hide">
        			<p>There was an error obtaining the data.</p>
        			<ul class="padded">
            			<li>
						Please reload the page (but perhaps wait half an hour first in case Habitica is under heavy load).
					</li>
            			<li>
						If you're using Internet Explorer, try another browser. <a href="https://www.google.com/intl/en/chrome/browser/">Chrome</a> 
						or <a href="https://www.mozilla.org/en-US/firefox/new/">Firefox</a> will be more reliable.
					</li>
        			</ul>
    		</div>
		</div>

		<div id="userStats"></div>
		<hr class="clear" />
		<div id="buttons"></div>
		<hr class="clear" />
	
		<div id="documentationAndForm">
   		 	<iframe src="null.htm" id="formPasswdSaveFix" name="formPasswdSaveFix" style="display:none">
			</iframe><!-- DAMN YOU CHROME!! DAMN YOU!!!! http://stackoverflow.com/a/9116737 -->
			<form id="userApiDetailsForm" method="POST" action="" target="formPasswdSaveFix">
				<fieldset>
       	     		<legend>
						<span class="highlight">
							Enter your Habitica API details
							(from <a href="https://habitica.com/user/settings/api" target="_blank"> User Icon &gt; Settings &gt; API</a>)
						</span>
            			</legend>
            			<label for="userId"><span>User ID</span>
           	     		<input type="text" name="userId" id="userId" value=""> <!-- Value entfernen -->
            			</label>
            			<label for="apiToken"><span>API Token</span>
           	     		<input type="password" name="apiToken" id="apiToken" value=""> <!-- Value entfernen -->
            			</label>
					<input type="submit" value="Fetch My Data" />
						<p style="font-size: 8px;">
							Datenschutzerklrung und Impressum:
							<br>
							Verantwortlicher: ABB Allgemeine Buchhaltungshilfe- und Betriebsberatungsges. mbH, Hammer Deich 70, 20537 Hamburg<br>
							<br>
							Personenbezogene Daten: Die Angaben zu User-ID und API-Token (habitica.com) werden nicht durch abbhh.de gespeichert und dienen ausschlielich 
							dem Zugriff auf habitica.com. abbhh.de speichert Serverlogfiles (IP-Adresse, verwendeter Browser, Referer-Url). Die Erhebung der Daten dient 
							dem Betrieb der Website. Die Daten werden nicht ausgewertet und nach 30 	Tagen gelscht. abbhh.de/wardrobes.html wird auf Ihrem Browser 
							ausgefhrt und speichet dort vom Benutzer ausgewhlte Einstellungen im LocalStorage oder alternativ als Cookie auf Ihrem Gert. Diese 
							Datenspeicherung erfolgt ausschlielich fr die Komfortoptimierung der Benutzer.<br>
							<br>
							Widerspruch gegen die Datenverarbeitung und Zustimmung zur Datenverarbeitung:<br>  						
							Durch Eingabe Ihrer Nutzerdaten User-ID und API-Token akzeptieren Sie die Erhebung o.g. Daten. Der Datenerhebung widersprechen Sie durch 
							Verzicht auf die Nutzung dieser Website. <br>
							<br>
   			   	   		   	Privacy and security notes:
   		   		   	 		<br>
							Personal Data / Contact: <br>
							Responsible Person: ABB Allgemeine Buchhaltungshilfe- und Betriebsberatungsges. mbH, Hammer Deich 70, 20537 Hamburg / Germany<br>
							<br>
							Personal data: The information on user ID and API tokens (habitica.com) are not stored abbhh.de and are used exclusively
							accessing habitica.com. abbhh.de stores server log files (IP address, browser used, referer url). The collection of data serves the operation of
							Website. The data will not be evaluated and will be deleted after 30 days. abbhh.de/wardrobes.html is executed on your browser and stores the user
							selected settings in the LocalStorage or alternatively as a cookie on your device. This data storage is exclusively done for the comfort of the users. 
							<br>
							Opposition to data processing and consent to data processing:<br>
							By entering your user data User-ID and API-Token you accept the survey of the data mentioned above. Contradict the data collection by waiving the use
							this website.<br>
							<br>General<br>			  
			   	    	    Your API Token is a password - do not share it with anyone, not even the maintainer of this page if you are seeking help.<br>
   			   		   	  	This page does not save your User ID and API Token to any location, but your browser might, if it has been configured to
       				   	  	save form and password information. If you are using this page on a shared computer, you should clear any data that the browser
       			   		  	has saved. <br>
							This page will make changes to your Habitica accout. It changes equipped gear, fires skills and tasks, lets you cron after crontime. 
							If anything goes wrong, please use the official access paths to Habitica (webpage, app). <br>
							Changes to the Habitica user data made on this webpage will take effect immediately on the official webpage or on the app. Visibility of changes 
							occur after a sync there. <br>
							This page is not Habitica code. It's third party. Autor is <a href="https://habitica.com/profile/9226cae6-d852-45da-a51b-ec2c9cb759e6">@Pitii</a> 
							(user of <a href="https://www.habitica.com">Habitica</a> and member of the guild 
							<a href="https://habitica.com/groups/guild/2ff9822b-27f2-4774-98da-db349b57a38e">'Aspiring Comrades'</a> and 
							<a href="https://habitica.com/groups/guild/ba3e642f-a109-4ad2-b041-301c2935189f">'Habitican Wardrobes'</a>). 
							Code can be viewed on <a href="https://github.com/PitiTheGrey/Habitican-Wardrobes">Github</a>.
						</p>
				</fieldset>
			</form>
		</div><!-- end of div id="documentationAndForm" -->
	</div><!-- end of div id="innerBody" -->
</body>

</html>
